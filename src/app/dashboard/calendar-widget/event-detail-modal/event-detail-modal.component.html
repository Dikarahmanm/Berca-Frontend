<div class="event-detail-modal">
  <!-- Modal Header -->
  <div class="modal-header" [class]="getPriorityClass()">
    <div class="header-content">
      <div class="event-type">
        <span class="event-icon">{{ eventTypeInfo.icon }}</span>
        <span class="event-type-label">{{ eventTypeInfo.label }}</span>
      </div>

      <h2 class="event-title">{{ event.title }}</h2>

      <div class="event-badges">
        <mat-chip class="priority-chip" [class]="getPriorityClass()">
          {{ priorityInfo.label }}
        </mat-chip>

        <mat-chip class="auto-generated-chip" *ngIf="event.isAutoGenerated">
          <mat-icon>smart_toy</mat-icon>
          Auto-generated
        </mat-chip>

        <mat-chip class="today-chip" *ngIf="isToday()">
          <mat-icon>today</mat-icon>
          Hari Ini
        </mat-chip>

        <mat-chip class="past-chip" *ngIf="isPastEvent()">
          <mat-icon>history</mat-icon>
          Sudah Lewat
        </mat-chip>
      </div>
    </div>

    <button mat-icon-button class="close-btn" (click)="close()" matTooltip="Close">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Modal Body -->
  <div class="modal-body">

    <!-- Date & Time Section -->
    <div class="detail-section">
      <div class="section-icon">
        <mat-icon>schedule</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Waktu Event</h3>

        <div class="time-info">
          <div class="time-row">
            <span class="time-label">Mulai:</span>
            <span class="time-value">{{ formatDateTime(event.startDate) }}</span>
          </div>

          <div class="time-row" *ngIf="event.endDate">
            <span class="time-label">Selesai:</span>
            <span class="time-value">{{ formatDateTime(event.endDate) }}</span>
          </div>

          <div class="time-row" *ngIf="event.isAllDay">
            <mat-chip class="all-day-chip">
              <mat-icon>event</mat-icon>
              Event Sepanjang Hari
            </mat-chip>
          </div>
        </div>
      </div>
    </div>

    <!-- Description Section -->
    <div class="detail-section" *ngIf="event.description">
      <div class="section-icon">
        <mat-icon>description</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Deskripsi</h3>
        <p class="description-text">{{ event.description }}</p>
      </div>
    </div>

    <!-- Branch Section -->
    <div class="detail-section" *ngIf="event.branchName">
      <div class="section-icon">
        <mat-icon>store</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Cabang</h3>
        <p class="branch-name">{{ event.branchName }}</p>
      </div>
    </div>

    <!-- Related Entity Section -->
    <div class="detail-section" *ngIf="event.relatedEntityType && event.relatedEntityName">
      <div class="section-icon">
        <mat-icon>link</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Terkait Dengan</h3>

        <div class="related-entity-card">
          <div class="entity-info">
            <span class="entity-type">{{ event.relatedEntityType }}</span>
            <span class="entity-name">{{ event.relatedEntityName }}</span>
            <span class="entity-details" *ngIf="event.relatedEntityDetails">
              {{ event.relatedEntityDetails }}
            </span>
          </div>

          <button
            mat-stroked-button
            color="primary"
            (click)="navigateToEntity()"
            class="view-entity-btn">
            <mat-icon>arrow_forward</mat-icon>
            Lihat Detail
          </button>
        </div>
      </div>
    </div>

    <!-- Reminder Section -->
    <div class="detail-section" *ngIf="event.hasReminder">
      <div class="section-icon">
        <mat-icon>notifications</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Pengingat</h3>

        <div class="reminder-info">
          <mat-icon [class.sent]="event.reminderSent">
            {{ event.reminderSent ? 'check_circle' : 'schedule' }}
          </mat-icon>
          <span>
            {{ event.reminderMinutes }} menit sebelum event
            <span class="sent-badge" *ngIf="event.reminderSent">âœ“ Terkirim</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Notes Section -->
    <div class="detail-section" *ngIf="event.notes">
      <div class="section-icon">
        <mat-icon>note</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Catatan</h3>
        <p class="notes-text">{{ event.notes }}</p>
      </div>
    </div>

    <!-- Action URL Section -->
    <div class="detail-section" *ngIf="event.actionUrl">
      <div class="section-icon">
        <mat-icon>link</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Link Terkait</h3>
        <a [href]="event.actionUrl" target="_blank" class="action-link">
          {{ event.actionUrl }}
          <mat-icon>open_in_new</mat-icon>
        </a>
      </div>
    </div>

    <!-- Recurrence Section -->
    <div class="detail-section" *ngIf="event.recurrencePattern">
      <div class="section-icon">
        <mat-icon>repeat</mat-icon>
      </div>
      <div class="section-content">
        <h3 class="section-title">Pengulangan</h3>
        <mat-chip class="recurrence-chip">
          <mat-icon>repeat</mat-icon>
          {{ event.recurrencePattern }}
        </mat-chip>
      </div>
    </div>

    <!-- Metadata Section -->
    <div class="metadata-section">
      <div class="metadata-row">
        <mat-icon>person</mat-icon>
        <span>Dibuat oleh: {{ event.createdByName || 'System' }}</span>
      </div>

      <div class="metadata-row">
        <mat-icon>access_time</mat-icon>
        <span>{{ formatDateTime(event.createdAt) }}</span>
      </div>

      <div class="metadata-row" *ngIf="event.updatedAt !== event.createdAt">
        <mat-icon>update</mat-icon>
        <span>Terakhir diupdate: {{ formatDateTime(event.updatedAt) }}</span>
      </div>
    </div>
  </div>

  <!-- Modal Footer -->
  <div class="modal-footer">
    <div class="footer-actions-left">
      <button
        mat-stroked-button
        color="warn"
        (click)="deleteEvent()"
        *ngIf="!event.isAutoGenerated">
        <mat-icon>delete</mat-icon>
        Hapus
      </button>
    </div>

    <div class="footer-actions-right">
      <button mat-button (click)="close()">
        Tutup
      </button>

      <button
        mat-raised-button
        color="accent"
        (click)="markAsDone()"
        *ngIf="!isPastEvent()">
        <mat-icon>check</mat-icon>
        Tandai Selesai
      </button>

      <button
        mat-raised-button
        color="primary"
        (click)="editEvent()"
        *ngIf="!event.isAutoGenerated">
        <mat-icon>edit</mat-icon>
        Edit
      </button>
    </div>
  </div>
</div>
