<!-- src/app/dashboard/dashboard-analytics/dashboard-analytics.component.html -->
<!-- ‚úÖ REDESIGNED: Clean Simple Design - No Material Design Complexity, High Contrast -->

<div class="dashboard-analytics">

  <!-- Header Section -->
  <header class="analytics-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon>analytics</mat-icon>
          Business Analytics
        </h1>
        <p class="page-subtitle">Real-time insights & performance metrics</p>
      </div>

      <div class="header-actions">
        <!-- Clean Simple Select - High Contrast Design -->
        <div class="period-selector">
          <label for="period-select" class="sr-only">Select Period</label>
          <select id="period-select" [ngModel]="selectedPeriod()" (ngModelChange)="selectedPeriod.set($event); onPeriodChange()" class="form-select" 
            aria-label="Select time period for analytics">
            <option value="today">üìÖ Hari Ini</option>
            <option value="week">üìä 7 Hari Terakhir</option>
            <option value="month">üóìÔ∏è 30 Hari Terakhir</option>
            <option value="year">üìà 1 Tahun Terakhir</option>
          </select>
        </div>

        <button class="btn btn-primary refresh-btn" (click)="refreshData()" [disabled]="isLoading()" type="button"
          title="Refresh dashboard data (Ctrl+R)" aria-label="Refresh analytics data">
          <mat-icon>refresh</mat-icon>
          <span>üîÑ Refresh</span>
        </button>

        <!-- New: Add Product Button - Clean Design -->
        <button class="btn btn-success" (click)="addNewProduct()" type="button" 
          title="Add new product (Ctrl+N)" aria-label="Add new product">
          <mat-icon>add</mat-icon>
          <span class="hide-mobile">‚ûï Tambah Produk</span>
        </button>

        <!-- New: Export Button - High Contrast -->
        <button class="btn btn-accent" (click)="exportAnalyticsData()" type="button" 
          title="Export analytics data" aria-label="Export analytics data">
          <mat-icon>download</mat-icon>
          <span class="hide-mobile">üì• Export</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Clean Loading State -->
  <div class="loading-overlay" *ngIf="isLoading()" role="status" aria-live="polite">
    <div class="loading-spinner"></div>
    <p>üîÑ Memuat data analytics...</p>
  </div>

  <!-- Main Content -->
  <main class="analytics-content" *ngIf="!isLoading()">

    <!-- Quick Stats Section -->
    <section class="quick-stats-section" *ngIf="currentQuickStats()" aria-labelledby="quick-stats-title">
      <div class="section-header">
        <h2 id="quick-stats-title">Quick Stats</h2>
        <p>Ringkasan performa hari ini</p>
      </div>

      <div class="quick-stats-grid">
        <article class="quick-stat-card revenue" role="article" aria-labelledby="revenue-stat">
          <div class="stat-icon" aria-hidden="true">
            üí∞
          </div>
          <div class="stat-content">
            <div class="stat-value" id="revenue-stat">{{ formatCurrency(currentQuickStats()?.todayRevenue || 0) }}</div>
            <div class="stat-label">Pendapatan Hari Ini</div>
            <div class="stat-change positive" *ngIf="currentQuickStats()?.revenueGrowthPercentage && currentQuickStats()!.revenueGrowthPercentage > 0">
              üìà
              <span>+{{ formatNumber(currentQuickStats()!.revenueGrowthPercentage) }}%</span>
            </div>
          </div>
        </article>

        <article class="quick-stat-card transactions" role="article" aria-labelledby="transactions-stat">
          <div class="stat-icon" aria-hidden="true">
            üßæ
          </div>
          <div class="stat-content">
            <div class="stat-value" id="transactions-stat">{{ formatNumber(currentQuickStats()?.todayTransactions || 0) }}</div>
            <div class="stat-label">Transaksi Hari Ini</div>
            <div class="stat-meta">Transaksi berhasil</div>
          </div>
        </article>

        <article class="quick-stat-card alerts" role="article" aria-labelledby="alerts-stat">
          <div class="stat-icon" aria-hidden="true">
            ‚ö†Ô∏è
          </div>
          <div class="stat-content">
            <div class="stat-value" id="alerts-stat">{{ formatNumber(currentQuickStats()?.lowStockAlerts || 0) }}</div>
            <div class="stat-label">Stok Menipis</div>
            <div class="stat-meta">Produk perlu restock</div>
          </div>
        </article>

        <article class="quick-stat-card members" role="article" aria-labelledby="members-stat">
          <div class="stat-icon" aria-hidden="true">
            üë•
          </div>
          <div class="stat-content">
            <div class="stat-value" id="members-stat">{{ formatNumber(currentQuickStats()?.activeMembers || 0) }}</div>
            <div class="stat-label">Member Aktif</div>
            <div class="stat-meta">Member terdaftar</div>
          </div>
        </article>
      </div>
    </section>

    <!-- KPI Cards Section -->
    <section class="kpi-section" aria-labelledby="kpi-title">
      <div class="section-header">
        <h2 id="kpi-title">Key Performance Indicators</h2>
        <p>Metrik performa utama bisnis</p>
      </div>

      <div class="kpi-grid">
        <article class="kpi-card revenue" role="article" aria-labelledby="kpi-revenue">
          <div class="kpi-icon" aria-hidden="true">
            üìà
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="kpi-revenue">{{ formatCurrency(currentKPIs()?.todayRevenue || 0) }}</div>
            <div class="kpi-label">Pendapatan Hari Ini</div>
            <div class="kpi-meta">{{ formatNumber(currentKPIs()?.todayTransactions || 0) }} transaksi</div>
          </div>
        </article>

        <article class="kpi-card monthly" role="article" aria-labelledby="kpi-monthly">
          <div class="kpi-icon" aria-hidden="true">
            üóìÔ∏è
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="kpi-monthly">{{ formatCurrency(currentKPIs()?.monthlyRevenue || 0) }}</div>
            <div class="kpi-label">Pendapatan Bulanan</div>
            <div class="kpi-meta">{{ formatNumber(currentKPIs()?.monthlyTransactions || 0) }} transaksi</div>
          </div>
        </article>

        <article class="kpi-card products" role="article" aria-labelledby="kpi-products">
          <div class="kpi-icon" aria-hidden="true">
            üì¶
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="kpi-products">{{ formatNumber(currentKPIs()?.totalProducts || 0) }}</div>
            <div class="kpi-label">Total Produk</div>
            <div class="kpi-meta">{{ formatNumber(currentKPIs()?.lowStockProducts || 0) }} stok rendah</div>
          </div>
        </article>

        <article class="kpi-card profit" role="article" aria-labelledby="kpi-profit">
          <div class="kpi-icon" aria-hidden="true">
            üí∞
          </div>
          <div class="kpi-content">
            <div class="kpi-value" id="kpi-profit">{{ formatCurrency(currentKPIs()?.totalProfit || 0) }}</div>
            <div class="kpi-label">Total Profit</div>
            <div class="kpi-meta">Rata-rata: {{ formatCurrency(currentKPIs()?.averageTransactionValue || 0) }}</div>
          </div>
        </article>
      </div>
    </section>

    <!-- Products Analytics Section -->
    <section class="products-section" aria-labelledby="products-title">
      <div class="section-header">
        <h2 id="products-title">Products Analytics</h2>
        <p>Analisis performa produk terlaris dan terburuk</p>
      </div>

      <div class="products-grid">

        <!-- Top Selling Products -->
        <article class="product-card top-products">
          <header class="card-header">
            <h3>
              üìà
              Produk Terlaris
            </h3>
            <button class="btn btn-primary" (click)="navigateToProducts()" type="button" 
              aria-label="View all top selling products">
              üëÅÔ∏è Lihat Semua
            </button>
          </header>

          <div class="product-list" *ngIf="topProducts().length > 0; else noTopProducts">
            <article class="top-product-item" *ngFor="let product of topProducts(); let i = index"
              (contextmenu)="showProductContextMenu($event, product.productId, product.productName)"
              title="Right-click for more options">
              <!-- Header with rank and weighted score -->
              <header class="product-header">
                <div class="rank-badge success" [attr.aria-label]="'Rank ' + (i + 1)">{{ i + 1 }}</div>
                <div class="product-basic-info">
                  <h4 class="product-name">{{ product.productName }}</h4>
                  <div class="product-barcode">{{ product.productBarcode }}</div>
                </div>
                <div class="weighted-score" [ngClass]="getTopProductScoreClass(product.weightedScore)">
                  {{ formatNumber(safeValue(product.weightedScore)) }}
                </div>
              </header>

              <!-- Performance metrics section -->
              <div class="performance-section">
                <div class="profit-margin-chip" [ngClass]="getProfitMarginClass(product.profitMargin)">
                  <mat-icon>percent</mat-icon>
                  {{ formatPercentage(safeValue(product.profitMargin)) }} Margin
                </div>
              </div>

              <!-- Key metrics in compact format -->
              <div class="metrics-grid">
                <div class="metric">
                  <div class="metric-value">{{ formatNumber(safeValue(product.totalQuantitySold)) }}</div>
                  <div class="metric-label">Terjual</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ formatNumber(safeValue(product.transactionCount)) }}</div>
                  <div class="metric-label">Transaksi</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ formatNumber(safeValue(product.averageQuantityPerTransaction)) }}</div>
                  <div class="metric-label">Avg/Trx</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ formatCurrency(safeValue(product.totalRevenue)) }}</div>
                  <div class="metric-label">Revenue</div>
                </div>
              </div>

              <!-- Enhanced Action buttons -->
              <footer class="product-actions">
                <button class="action-btn quick-view" (click)="showProductQuickView(product.productId)" type="button"
                  title="Quick View" [attr.aria-label]="'Quick view for ' + product.productName">
                  <mat-icon>preview</mat-icon>
                </button>
                <button class="action-btn edit-btn" (click)="viewProductDetails(product.productId)" type="button"
                  title="Edit Product" [attr.aria-label]="'Edit details for ' + product.productName">
                  <mat-icon>edit</mat-icon>
                </button>
              </footer>
            </article>
          </div>

          <ng-template #noTopProducts>
            <div class="empty-state">
              <div class="empty-icon">üì¶</div>
              <p>Belum ada data produk terlaris</p>
            </div>
          </ng-template>
        </article>

        <!-- Worst Performing Products -->
        <article class="product-card worst-products">
          <header class="card-header">
            <h3>
              üìâ
              Produk Performa Buruk
            </h3>
            <div class="header-actions">
              <div class="category-filter">
                <label for="worst-category-select" class="sr-only">Filter Kategori</label>
                <select id="worst-category-select" [ngModel]="selectedWorstCategory()"
                  (ngModelChange)="selectedWorstCategory.set($event); onWorstCategoryChange()" class="form-select" 
                  aria-label="Filter products by category">
                  <option value="all">üè∑Ô∏è Semua Kategori</option>
                  <option *ngFor="let category of getWorstCategories()" [value]="category">
                    üìÇ {{ category }}
                  </option>
                </select>
              </div>
              <button class="btn btn-warning" (click)="navigateToProducts()" type="button" 
                aria-label="View all worst performing products">
                üëÅÔ∏è Lihat Semua
              </button>
            </div>
          </header>

          <div class="product-list" *ngIf="getSortedWorstProducts().length > 0; else noWorstProducts">
            <article class="worst-product-item" [attr.data-category]="product.performanceCategory"
              *ngFor="let product of getSortedWorstProducts(); let i = index"
              (contextmenu)="showProductContextMenu($event, product.productId, product.productName)"
              title="Right-click for more options">
              <!-- Header with rank and category -->
              <header class="product-header">
                <div class="rank-badge" [attr.aria-label]="'Rank ' + (i + 1)">{{ i + 1 }}</div>
                <div class="product-basic-info">
                  <h4 class="product-name">{{ product.productName }}</h4>
                  <div class="product-barcode">{{ product.productBarcode }}</div>
                </div>
                <div class="performance-score" [ngClass]="getPerformanceScoreClass(product.performanceScore)">
                  {{ product.performanceScore }}
                </div>
              </header>

              <!-- Performance category chip -->
              <div class="category-section">
                <div class="category-chip" [attr.data-category]="product.performanceCategory">
                  <mat-icon>{{ getPerformanceCategoryIcon(product.performanceCategory) }}</mat-icon>
                  {{ product.performanceCategory }}
                </div>
              </div>

              <!-- Key metrics in compact format -->
              <div class="metrics-grid">
                <div class="metric">
                  <div class="metric-value">{{ formatNumber(safeValue(product.totalQuantitySold)) }}</div>
                  <div class="metric-label">Terjual</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ formatNumber(safeValue(product.currentStock)) }}</div>
                  <div class="metric-label">Stok</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ formatNumber(safeValue(product.daysWithoutSale)) }}</div>
                  <div class="metric-label">Hari</div>
                </div>
                <div class="metric">
                  <div class="metric-value">{{ formatCurrency(safeValue(product.totalRevenue)) }}</div>
                  <div class="metric-label">Revenue</div>
                </div>
              </div>

              <!-- Enhanced Action buttons -->
              <footer class="product-actions">
                <button class="action-btn quick-view" (click)="showProductQuickView(product.productId)" type="button"
                  title="Quick View" [attr.aria-label]="'Quick view for ' + product.productName">
                  <mat-icon>preview</mat-icon>
                </button>
                <button class="action-btn edit-btn" (click)="viewProductDetails(product.productId)" type="button"
                  title="Edit Product" [attr.aria-label]="'Edit details for ' + product.productName">
                  <mat-icon>edit</mat-icon>
                </button>
              </footer>
            </article>
          </div>

          <ng-template #noWorstProducts>
            <div class="empty-state">
              <div class="empty-icon">üìâ</div>
              <p>Belum ada data produk performa buruk</p>
            </div>
          </ng-template>
        </article>
      </div>
    </section>

    <!-- Revenue by Category Section -->
    <section class="category-revenue-section" aria-labelledby="category-revenue-title">
      <header class="card-header">
        <h3 id="category-revenue-title">
          ü•∞
          Pendapatan per Kategori
        </h3>
        <button class="btn btn-primary" (click)="navigateToReports()" type="button" 
          aria-label="View detailed category revenue report">
          üìä Lihat Detail
        </button>
      </header>

      <div class="category-grid" *ngIf="categorySales().length > 0; else noCategoryData">
        <article class="category-item" *ngFor="let category of categorySales()"
          (click)="filterProductsByCategory(category.categoryName)" class="clickable-category"
          title="Click to filter products by this category">
          <div class="category-color" [style.background-color]="category.categoryColor"></div>
          <div class="category-info">
            <h4 class="category-name">{{ category.categoryName }}</h4>
            <div class="category-stats">
              <span>{{ formatNumber(category.productCount) }} produk</span>
              <span>‚Ä¢</span>
              <span>{{ formatNumber(category.totalQuantitySold) }} terjual</span>
            </div>
          </div>
          <div class="category-revenue">
            <div class="revenue-amount">{{ formatCurrency(category.totalRevenue) }}</div>
            <div class="transaction-count">{{ formatNumber(category.transactionCount) }} transaksi</div>
          </div>
        </article>
      </div>

      <ng-template #noCategoryData>
        <div class="empty-state">
          <div class="empty-icon">üè∑Ô∏è</div>
          <p>Belum ada data penjualan per kategori</p>
        </div>
      </ng-template>
    </section>

    <!-- Recent Transactions Section -->
    <section class="transactions-section" aria-labelledby="transactions-title">
      <header class="card-header">
        <h3 id="transactions-title">
          üßæ
          Transaksi Terbaru
        </h3>
        <button class="btn btn-primary" (click)="navigateToTransactions()" type="button" 
          aria-label="View all recent transactions">
          üëÅÔ∏è Lihat Semua
        </button>
      </header>

      <div class="transactions-list" *ngIf="recentTransactions().length > 0; else noTransactions">
        <article class="transaction-item" *ngFor="let transaction of recentTransactions()"
          (contextmenu)="showTransactionContextMenu($event, transaction)" title="Right-click for more options">
          <div class="transaction-id">
            <mat-icon>receipt</mat-icon>
            <span>{{ transaction.saleNumber }}</span>
          </div>
          <div class="transaction-info">
            <h4 class="transaction-customer">{{ transaction.customerName || 'Customer' }}</h4>
            <div class="transaction-cashier">Kasir: {{ transaction.cashierName || 'Unknown' }}</div>
            <div class="transaction-date">{{ transaction.saleDate | date:'dd/MM/yyyy HH:mm' }}</div>
          </div>
          <div class="transaction-details">
            <div class="transaction-amount">{{ formatCurrency(transaction.total) }}</div>
            <div class="transaction-items">{{ formatNumber(transaction.itemCount) }} item</div>
            <div class="transaction-method">{{ transaction.paymentMethod }}</div>
          </div>
          <div class="transaction-actions">
            <button class="action-btn quick-view" (click)="showTransactionQuickView(transaction)" type="button"
              title="Quick View Transaction" [attr.aria-label]="'Quick view for transaction ' + transaction.saleNumber">
              <mat-icon>preview</mat-icon>
            </button>
            <button class="action-btn detail-btn" (click)="viewTransactionDetails(transaction)" type="button"
              title="View Full Details"
              [attr.aria-label]="'View full details for transaction ' + transaction.saleNumber">
              <mat-icon>visibility</mat-icon>
            </button>
          </div>
        </article>
      </div>

      <ng-template #noTransactions>
        <div class="empty-state">
          <div class="empty-icon">üßæ</div>
          <p>Belum ada transaksi terbaru</p>
        </div>
      </ng-template>
    </section>

    <!-- Low Stock Alerts Section -->
    <section class="low-stock-section" aria-labelledby="low-stock-title">
      <header class="card-header">
        <h3 id="low-stock-title">
          ‚ö†Ô∏è
          Peringatan Stok Menipis
          <span class="stock-count-badge">üî¢ {{ lowStockAlerts().length }} items</span>
        </h3>
        <button class="btn btn-warning" (click)="navigateToInventory()" type="button" 
          aria-label="Manage inventory stock levels">
          üì¶ Kelola Stok
        </button>
      </header>

      <div class="low-stock-list" *ngIf="lowStockAlerts().length > 0; else noLowStock">
        <article class="low-stock-item" *ngFor="let item of lowStockAlerts()"
          (contextmenu)="showStockContextMenu($event, item)" title="Right-click for quick actions">
          <div class="stock-status" [ngClass]="item.isOutOfStock ? 'out-of-stock' : 'low-stock'">
            <mat-icon>{{ item.isOutOfStock ? 'block' : 'warning' }}</mat-icon>
          </div>
          <div class="item-info">
            <h4 class="item-name">{{ item.name }}</h4>
            <div class="item-category">{{ item.categoryName }}</div>
            <div class="item-barcode">{{ item.barcode }}</div>
          </div>
          <div class="stock-info">
            <div class="current-stock" [ngClass]="item.isOutOfStock ? 'danger' : 'warning'">
              {{ formatNumber(item.stock) }} {{ item.unit }}
            </div>
            <div class="min-stock">Min: {{ formatNumber(item.minimumStock) }}</div>
            <div class="stock-status-text">
              {{ item.isOutOfStock ? 'Habis' : 'Stok Rendah' }}
            </div>
          </div>
          <div class="item-actions">
            <button class="btn btn-sm quick-restock-btn" [ngClass]="item.isOutOfStock ? 'btn-error' : 'btn-warning'"
              (click)="restockProduct(item.id, item.name)" type="button" title="Quick restock this product">
              <mat-icon>add_circle</mat-icon>
              {{ item.isOutOfStock ? 'Restock Sekarang' : 'Quick Restock' }}
            </button>

            <button class="btn btn-sm btn-primary" (click)="manageProductStock(item.id)" type="button"
              title="Manage stock details">
              <mat-icon>inventory</mat-icon>
              Kelola Stok
            </button>
          </div>
        </article>
      </div>

      <ng-template #noLowStock>
        <div class="empty-state success">
          <div class="empty-icon">‚úÖ</div>
          <p>Semua produk memiliki stok yang mencukupi</p>
        </div>
      </ng-template>
    </section>

    <!-- ===== SMART ANALYTICS SECTIONS ===== -->
    
    <!-- Smart Analytics Toggle -->
    <section class="smart-analytics-toggle" *ngIf="!isLoading()">
      <div class="toggle-header">
        <h2>üß† Smart Analytics</h2>
        <p>AI-powered insights and recommendations</p>
      </div>
      <button class="btn btn-accent toggle-btn" (click)="onToggleAdvancedAnalytics()" type="button"
        [attr.aria-expanded]="showAdvancedAnalytics()"
        [attr.aria-label]="showAdvancedAnalytics() ? 'Hide advanced analytics' : 'Show advanced analytics'">
        <mat-icon>{{ showAdvancedAnalytics() ? 'expand_less' : 'expand_more' }}</mat-icon>
        <span>{{ showAdvancedAnalytics() ? 'Hide' : 'Show' }} Advanced Analytics</span>
      </button>
    </section>

    <!-- Smart Analytics Content -->
    <div class="smart-analytics-content" *ngIf="showAdvancedAnalytics()">

      <!-- Smart Analytics Loading State -->
      <div class="smart-loading-overlay" *ngIf="isSmartAnalyticsLoading()" role="status" aria-live="polite">
        <div class="loading-spinner"></div>
        <p>üß† Loading smart analytics...</p>
      </div>

      <!-- Expiry Analytics Section -->
      <section class="expiry-analytics-section" *ngIf="smartAnalyticsData()" aria-labelledby="expiry-title">
        <div class="section-header">
          <h3 id="expiry-title">
            <mat-icon>schedule</mat-icon>
            Expiry Analytics
          </h3>
          <p>AI-powered expiry predictions and insights</p>
        </div>

        <div class="expiry-overview-grid">
          <div class="expiry-stat-card critical">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-content">
              <div class="stat-value">{{ smartAnalyticsData()!.expiringIn7Days }}</div>
              <div class="stat-label">Expiring in 7 Days</div>
            </div>
          </div>

          <div class="expiry-stat-card warning">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-content">
              <div class="stat-value">{{ smartAnalyticsData()!.expiringIn30Days }}</div>
              <div class="stat-label">Expiring in 30 Days</div>
            </div>
          </div>

          <div class="expiry-stat-card info">
            <div class="stat-icon">üí∞</div>
            <div class="stat-content">
              <div class="stat-value">{{ formatCurrency(smartAnalyticsData()!.potentialLossValue) }}</div>
              <div class="stat-label">Potential Loss</div>
            </div>
          </div>

          <div class="expiry-stat-card success">
            <div class="stat-icon">üì¶</div>
            <div class="stat-content">
              <div class="stat-value">{{ smartAnalyticsData()!.totalProducts }}</div>
              <div class="stat-label">Total Products</div>
            </div>
          </div>
        </div>
      </section>

      <!-- FIFO Recommendations Section -->
      <section class="fifo-recommendations-section" *ngIf="fifoRecommendations().length > 0" aria-labelledby="fifo-title">
        <div class="section-header">
          <h3 id="fifo-title">
            <mat-icon>smart_toy</mat-icon>
            FIFO Recommendations
          </h3>
          <p>AI-powered inventory optimization suggestions</p>
        </div>

        <div class="fifo-recommendations-list">
          <article class="fifo-recommendation-item" 
            *ngFor="let recommendation of criticalFifoRecommendations()"
            [class]="'priority-' + recommendation.priority.toLowerCase()">
            
            <div class="recommendation-header">
              <div class="product-info">
                <h4 class="product-name">{{ recommendation.productName }}</h4>
                <div class="product-code">{{ recommendation.productBarcode }}</div>
              </div>
              <div class="priority-badge" [class]="'priority-' + recommendation.priority.toLowerCase()">
                {{ recommendation.priority }}
              </div>
            </div>

            <div class="recommendation-details">
              <div class="detail-grid">
                <div class="detail-item">
                  <mat-icon>inventory</mat-icon>
                  <span>{{ recommendation.currentStock }} units</span>
                </div>
                <div class="detail-item">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ formatExpiryDate(recommendation.expiryDate) }}</span>
                </div>
                <div class="detail-item">
                  <mat-icon>savings</mat-icon>
                  <span>Save {{ formatCurrency(recommendation.potentialSavings) }}</span>
                </div>
              </div>
            </div>

            <div class="recommendation-action">
              <div class="ai-suggestion">
                <mat-icon>psychology</mat-icon>
                <span>{{ recommendation.recommendedAction }}</span>
              </div>
              <button class="btn btn-sm btn-primary" 
                (click)="onExecuteFifoRecommendation(recommendation)"
                [attr.aria-label]="'Execute recommendation for ' + recommendation.productName">
                Execute
              </button>
            </div>

            <div class="confidence-indicator">
              <span class="confidence-label">AI Confidence:</span>
              <div class="confidence-bar">
                <div class="confidence-fill" [style.width.%]="(recommendation.confidenceScore * 100)"></div>
              </div>
              <span class="confidence-score">{{ (recommendation.confidenceScore * 100).toFixed(0) }}%</span>
            </div>
          </article>
        </div>
      </section>

      <!-- Multi-Branch Analytics Section -->
      <section class="multi-branch-section" *ngIf="crossBranchAnalytics()" aria-labelledby="branch-title">
        <div class="section-header">
          <h3 id="branch-title">
            <mat-icon>account_tree</mat-icon>
            Multi-Branch Analytics
          </h3>
          <p>Cross-branch performance and transfer opportunities</p>
        </div>

        <div class="branch-overview-grid">
          <div class="branch-stat-card">
            <div class="stat-icon">üè¢</div>
            <div class="stat-content">
              <div class="stat-value">{{ crossBranchAnalytics()!.totalBranches }}</div>
              <div class="stat-label">Total Branches</div>
            </div>
          </div>

          <div class="branch-stat-card">
            <div class="stat-icon">üîÑ</div>
            <div class="stat-content">
              <div class="stat-value">{{ crossBranchAnalytics()!.totalTransfers }}</div>
              <div class="stat-label">Total Transfers</div>
            </div>
          </div>

          <div class="branch-stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-content">
              <div class="stat-value">{{ formatCurrency(crossBranchAnalytics()!.transfersSavings) }}</div>
              <div class="stat-label">Transfer Savings</div>
            </div>
          </div>
        </div>

        <!-- Transfer Opportunities -->
        <div class="transfer-opportunities" *ngIf="criticalTransferOpportunities().length > 0">
          <h4>üöö Transfer Opportunities</h4>
          <div class="transfer-list">
            <article class="transfer-item" *ngFor="let opportunity of criticalTransferOpportunities()">
              <div class="transfer-header">
                <div class="product-info">
                  <h5>{{ opportunity.productName }}</h5>
                  <div class="transfer-route">{{ opportunity.fromBranchName }} ‚Üí {{ opportunity.toBranchName }}</div>
                </div>
                <div class="urgency-badge" [class]="'urgency-' + opportunity.urgency.toLowerCase()">
                  {{ opportunity.urgency }}
                </div>
              </div>

              <div class="transfer-details">
                <div class="detail-item">
                  <span class="detail-label">Quantity:</span>
                  <span class="detail-value">{{ opportunity.quantity }} units</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Savings:</span>
                  <span class="detail-value">{{ formatCurrency(opportunity.potentialSavings) }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Net Benefit:</span>
                  <span class="detail-value">{{ formatCurrency(opportunity.netBenefit) }}</span>
                </div>
              </div>

              <div class="transfer-action">
                <button class="btn btn-sm btn-success" 
                  (click)="onExecuteTransferOpportunity(opportunity)"
                  [attr.aria-label]="'Execute transfer for ' + opportunity.productName">
                  Execute Transfer
                </button>
              </div>
            </article>
          </div>
        </div>
      </section>

      <!-- Smart Notifications Section -->
      <section class="smart-notifications-section" *ngIf="smartNotifications().length > 0" aria-labelledby="smart-notif-title">
        <div class="section-header">
          <h3 id="smart-notif-title">
            <mat-icon>notifications_active</mat-icon>
            Smart Notifications
          </h3>
          <p>Intelligent alerts and recommendations</p>
        </div>

        <div class="smart-notifications-list">
          <article class="smart-notification-item" 
            *ngFor="let notification of smartNotifications().slice(0, 5)"
            [class]="'priority-' + notification.priority.toLowerCase()">
            
            <div class="notification-icon">
              <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
            </div>

            <div class="notification-content">
              <h4 class="notification-title">{{ notification.title }}</h4>
              <p class="notification-message">{{ notification.message }}</p>
              <div class="notification-meta">
                <span class="notification-time">{{ formatNotificationTime(notification.createdAt) }}</span>
                <span class="notification-priority">{{ notification.priority }}</span>
              </div>
            </div>

            <div class="notification-actions" *ngIf="!notification.isRead">
              <button class="btn btn-sm btn-outline" 
                (click)="markNotificationAsRead(notification.id)"
                aria-label="Mark notification as read">
                Mark Read
              </button>
            </div>
          </article>
        </div>
      </section>

      <!-- Analytics Summary -->
      <section class="analytics-summary-section">
        <div class="section-header">
          <h3>
            <mat-icon>summarize</mat-icon>
            Analytics Summary
          </h3>
          <p>Key insights and recommendations</p>
        </div>

        <div class="summary-cards">
          <div class="summary-card insights">
            <h4>üí° Key Insights</h4>
            <ul class="insights-list">
              <li *ngIf="expiringProductsCount() > 0">
                {{ expiringProductsCount() }} products expiring soon - review FIFO recommendations
              </li>
              <li *ngIf="totalPotentialSavings() > 0">
                Potential savings of {{ formatCurrency(totalPotentialSavings()) }} through optimization
              </li>
              <li *ngIf="unreadSmartNotifications() > 0">
                {{ unreadSmartNotifications() }} smart notifications require attention
              </li>
            </ul>
          </div>

          <div class="summary-card actions">
            <h4>‚ö° Recommended Actions</h4>
            <div class="action-buttons">
              <button class="btn btn-sm btn-primary" (click)="navigateToExpiryManagement()">
                <mat-icon>schedule</mat-icon>
                Manage Expiry
              </button>
              <button class="btn btn-sm btn-success" (click)="navigateToMultiBranchCoordination()">
                <mat-icon>account_tree</mat-icon>
                Coordinate Branches
              </button>
              <button class="btn btn-sm btn-info" (click)="navigateToSmartNotifications()">
                <mat-icon>notifications</mat-icon>
                View Notifications
              </button>
            </div>
          </div>
        </div>
      </section>

    </div>

    <!-- Keyboard Shortcuts Help -->
    <div class="keyboard-shortcuts-hint" *ngIf="!isLoading">
      <div class="shortcuts-content">
        <span class="shortcuts-label">Keyboard Shortcuts:</span>
        <span class="shortcut-item">Ctrl+R: Refresh</span>
        <span class="shortcut-item">Ctrl+N: New Product</span>
        <span class="shortcut-item">Ctrl+I: Inventory</span>
        <span class="shortcut-item">Ctrl+T: Transactions</span>
      </div>
    </div>

  </main>

  <!-- Empty State -->
  <div class="empty-dashboard" *ngIf="!isLoading() && !currentKPIs()" role="status">
    <div class="empty-icon">üìä</div>
    <h2>Belum Ada Data Analytics</h2>
    <p>Data analytics akan muncul setelah ada transaksi dan aktivitas bisnis</p>
    <button class="btn btn-primary" (click)="refreshData()" type="button" 
      aria-label="Reload analytics data">
      <mat-icon>refresh</mat-icon>
      <span>üîÑ Muat Ulang Data</span>
    </button>
  </div>

</div>