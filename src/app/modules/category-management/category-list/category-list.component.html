<!-- src/app/modules/category-management/category-list/category-list.component.html -->
<!-- ✅ FIXED - Clean, professional, dan mudah dibaca -->

<div class="category-list-container">

    <!-- ==================== PAGE HEADER ==================== -->
    <div class="page-header">
        <div class="header-content">
            <div class="title-section">
                <h1 class="page-title">
                    <svg class="title-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z" />
                    </svg>
                    Category Management
                </h1>
                <p class="page-subtitle">Kelola kategori produk untuk Toko Eniwan</p>
            </div>

            <div class="header-actions">
                <button type="button" class="action-btn secondary-btn" (click)="refreshCategories()"
                    [disabled]="loading" title="Refresh data kategori">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                    </svg>
                    <span>Refresh</span>
                </button>

                <button type="button" class="action-btn export-btn" (click)="exportCategories()"
                    [disabled]="categories.length === 0" title="Export kategori ke Excel">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z" />
                    </svg>
                    <span>Export</span>
                </button>

                <button type="button" class="action-btn primary-btn" (click)="onCreateCategory()"
                    title="Tambah kategori baru">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                    <span>Add Category</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== LOADING STATE ==================== -->
    <div class="loading-container" *ngIf="loading">
        <div class="loading-grid">
            <div class="category-card-skeleton" *ngFor="let item of [1,2,3,4,5,6]">
                <div class="skeleton-color"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title"></div>
                    <div class="skeleton-description"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== ERROR STATE ==================== -->
    <div class="error-container" *ngIf="error && !loading">
        <div class="error-content">
            <svg class="error-icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
            </svg>
            <h3 class="error-title">Oops! Something went wrong</h3>
            <p class="error-message">{{ error }}</p>
            <button type="button" class="action-btn primary-btn" (click)="refreshCategories()">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                </svg>
                <span>Try Again</span>
            </button>
        </div>
    </div>

    <!-- ==================== EMPTY STATE ==================== -->
    <div class="empty-state" *ngIf="!loading && !error && categories.length === 0">
        <div class="empty-content">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z" />
            </svg>
            <h3 class="empty-title">No Categories Found</h3>
            <p class="empty-description">
                {{ searchForm.get('searchTerm')?.value ?
                'No categories match your search criteria. Try adjusting your filters.' :
                'Get started by creating your first category for better product organization.' }}
            </p>
            <button type="button" class="action-btn primary-btn" (click)="onCreateCategory()">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                <span>Create First Category</span>
            </button>
        </div>
    </div>

    <!-- ==================== MAIN CONTENT (when data exists) ==================== -->
    <ng-container *ngIf="!loading && !error && categories.length > 0">

        <!-- Search & Filter Bar -->
        <div class="filter-bar">
            <div class="filter-content">

                <!-- Search Section -->
                <div class="search-section">
                    <form [formGroup]="searchForm" class="search-form" (ngSubmit)="onSearch()">
                        <div class="search-input-wrapper">
                            <svg class="search-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                            </svg>
                            <input type="text" placeholder="Search categories by name..." formControlName="searchTerm"
                                class="search-input" autocomplete="off">
                            <button type="button" class="clear-search-btn" (click)="onSearchClear()"
                                *ngIf="searchForm.get('searchTerm')?.value" title="Clear search">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Filter Controls -->
                <div class="filter-controls">
                    <button type="button" class="filter-toggle-btn" (click)="toggleFilters()"
                        [class.active]="showFilters" title="Toggle advanced filters">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z" />
                        </svg>
                        <span>Filters</span>
                        <span class="filter-count"
                            *ngIf="(filterForm.get('color')?.value || searchForm.get('searchTerm')?.value)">
                        </span>
                    </button>

                    <!-- View Mode Controls -->
                    <div class="view-mode-controls">
                        <button type="button" class="view-btn" [class.active]="viewMode.type === 'grid'"
                            (click)="setViewMode('grid')" title="Grid view">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z" />
                            </svg>
                        </button>
                        <button type="button" class="view-btn" [class.active]="viewMode.type === 'list'"
                            (click)="setViewMode('list')" title="List view">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters (Collapsible) -->
            <div class="advanced-filters" [class.show]="showFilters">
                <form [formGroup]="filterForm" class="filter-form">

                    <!-- Color Filter -->
                    <div class="filter-group">
                        <label class="filter-label">Filter by Color:</label>
                        <div class="color-filter-grid">
                            <button type="button" class="color-filter-btn"
                                [class.active]="filterForm.get('color')?.value === color"
                                [style.background-color]="color" (click)="onColorFilter(color)"
                                *ngFor="let color of defaultColors" [title]="color">
                                <svg *ngIf="filterForm.get('color')?.value === color" class="check-icon"
                                    viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                                </svg>
                            </button>
                            <button type="button" class="color-filter-btn clear-color"
                                [class.active]="!filterForm.get('color')?.value" (click)="onColorFilter('')"
                                title="Show all colors">
                                <span>All</span>
                            </button>
                        </div>
                    </div>

                    <!-- Sort Options -->
                    <div class="filter-group">
                        <label class="filter-label">Sort by:</label>
                        <div class="sort-controls">
                            <select formControlName="sortBy" class="sort-select">
                                <option *ngFor="let option of sortOptions" [value]="option.value">
                                    {{ option.label }}
                                </option>
                            </select>
                            <button type="button" class="sort-order-btn"
                                [class.desc]="filterForm.get('sortOrder')?.value === 'desc'" (click)="toggleSortOrder()"
                                title="Change sort direction">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7 14l5-5 5 5z" *ngIf="filterForm.get('sortOrder')?.value === 'asc'" />
                                    <path d="M7 10l5 5 5-5z" *ngIf="filterForm.get('sortOrder')?.value === 'desc'" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Page Size -->
                    <div class="filter-group">
                        <label class="filter-label">Items per page:</label>
                        <select formControlName="pageSize" class="page-size-select">
                            <option *ngFor="let size of pageSizeOptions" [value]="size">
                                {{ size }} items
                            </option>
                        </select>
                    </div>

                    <!-- Clear Filters -->
                    <div class="filter-actions">
                        <button type="button" class="clear-filters-btn" (click)="clearAllFilters()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                            <span>Clear All</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Selection Bar (when items are selected) -->
        <div class="selection-bar" *ngIf="hasSelection">
            <div class="selection-info">
                <span class="selection-count">{{ selectedCount }} category(s) selected</span>
            </div>
            <div class="selection-actions">
                <button type="button" class="selection-btn danger-btn" (click)="onBulkDelete()" [disabled]="loading">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                    </svg>
                    <span>Delete Selected</span>
                </button>
                <button type="button" class="selection-btn secondary-btn" (click)="clearSelection()">
                    <span>Clear Selection</span>
                </button>
            </div>
        </div>

        <!-- Category Grid -->
        <div class="category-grid" [class.grid-view]="viewMode.type === 'grid'"
            [class.list-view]="viewMode.type === 'list'" [class.size-small]="viewMode.size === 'small'"
            [class.size-medium]="viewMode.size === 'medium'" [class.size-large]="viewMode.size === 'large'">

            <div class="category-card" *ngFor="let category of categories; trackBy: trackByCategory"
                [class.selected]="isSelected(category.id)" (click)="toggleCategorySelection(category.id)"
                [attr.aria-label]="'Category: ' + category.name">

                <!-- Color Preview -->
                <div class="category-color" [style.background-color]="category.color">
                    <div class="color-overlay">
                        <span class="color-code" [style.color]="getContrastTextColor(category.color)">
                            {{ category.color }}
                        </span>
                    </div>

                    <!-- Selection Checkbox -->
                    <div class="selection-checkbox" [class.checked]="isSelected(category.id)"
                        [attr.aria-label]="isSelected(category.id) ? 'Selected' : 'Not selected'">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                        </svg>
                    </div>
                </div>

                <!-- Category Info -->
                <div class="category-info">
                    <div class="category-header">
                        <h3 class="category-name">{{ category.name }}</h3>
                        <span class="product-count" *ngIf="category.productCount && category.productCount > 0">
                            {{ category.productCount }} {{ category.productCount === 1 ? 'product' : 'products' }}
                        </span>
                    </div>

                    <p class="category-description" *ngIf="category.description">
                        {{ category.description }}
                    </p>

                    <div class="category-meta">
                        <span class="meta-item">
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 12px; height: 12px;">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                            </svg>
                            Created: {{ category.createdAt | date:'MMM dd, yyyy' }}
                        </span>
                        <span class="meta-item" *ngIf="category.updatedAt && category.updatedAt !== category.createdAt">
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 12px; height: 12px;">
                                <path
                                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                            </svg>
                            Updated: {{ category.updatedAt | date:'MMM dd, yyyy' }}
                        </span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="category-actions" (click)="$event.stopPropagation()">
                    <button type="button" class="action-btn small" (click)="onEditCategory(category)"
                        title="Edit category">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                        </svg>
                    </button>

                    <button type="button" class="action-btn small" (click)="onDuplicateCategory(category)"
                        title="Duplicate category">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>

                    <button type="button" class="action-btn small danger" (click)="onDeleteCategory(category)"
                        title="Delete category">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-info">
                <span class="results-info">
                    Showing {{ categories.length }} categories
                </span>
            </div>
        </div>

    </ng-container>

    <!-- ==================== DELETE CONFIRMATION MODAL ==================== -->
    <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
        <div class="delete-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-icon danger-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                    </svg>
                </div>
                <h3>Delete Category</h3>
            </div>

            <div class="modal-content">
                <p>Are you sure you want to delete the category <strong>"{{ categoryToDelete?.name }}"</strong>?</p>

                <div class="category-preview" *ngIf="categoryToDelete">
                    <div class="preview-color" [style.background-color]="categoryToDelete.color"></div>
                    <div class="preview-info">
                        <span class="preview-name">{{ categoryToDelete.name }}</span>
                        <span class="preview-description" *ngIf="categoryToDelete.description">
                            {{ categoryToDelete.description }}
                        </span>
                    </div>
                </div>

                <p class="warning-text">
                    ⚠️ This action cannot be undone. All products in this category will need to be reassigned.
                </p>
            </div>

            <div class="modal-actions">
                <button type="button" class="modal-btn cancel-btn" (click)="closeDeleteModal()">
                    <span>Cancel</span>
                </button>
                <button type="button" class="modal-btn delete-btn" (click)="confirmDelete()" [disabled]="loading">
                    <span *ngIf="!loading">Delete Category</span>
                    <span *ngIf="loading" class="loading-text">
                        <div class="spinner"></div>
                        Deleting...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== CATEGORY FORM MODALS ==================== -->
    <!-- Create Modal -->
    <app-category-form-modal *ngIf="showCreateModal" [isOpen]="showCreateModal" [mode]="'create'"
        (categoryCreated)="onCategoryCreated($event)" (modalClosed)="closeCreateModal()">
    </app-category-form-modal>

    <!-- Edit Modal -->
    <app-category-form-modal *ngIf="showEditModal && categoryToEdit" [isOpen]="showEditModal" [mode]="'edit'"
        [category]="categoryToEdit" (categoryUpdated)="onCategoryUpdated($event)" (modalClosed)="closeEditModal()">
    </app-category-form-modal>

</div>

<!-- ==================== FLOATING ACTION BUTTON (Mobile) ==================== -->
<div class="fab-container" *ngIf="!loading && !error">
    <button type="button" class="fab primary-fab" (click)="onCreateCategory()" title="Add new category"
        [attr.aria-label]="'Add new category'">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
        </svg>
    </button>
</div>

<style>
    /* FAB styles for mobile */
    .fab-container {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 100;

        @media (min-width: 769px) {
            display: none;
        }
    }

    .fab {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        transition: all 120ms ease-out;

        &.primary-fab {
            background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-dark));
            color: white;

            &:hover {
                transform: scale(1.1);
                box-shadow: 0 12px 32px rgba(255, 145, 77, 0.3);
            }

            &:active {
                transform: scale(0.95);
            }
        }

        svg {
            width: 24px;
            height: 24px;
        }
    }
</style>