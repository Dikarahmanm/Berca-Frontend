<!-- ===== FIXED: INVENTORY LIST TEMPLATE WITH RESPONSIVE COLUMNS ===== -->
<!-- src/app/modules/inventory/components/inventory-list/inventory-list.component.html -->

<div class="inventory-container">
  <!-- ===== HEADER SECTION ===== -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon>inventory_2</mat-icon>
          Inventory Management
        </h1>
        <p class="page-subtitle">Manage products, stock levels, and inventory operations</p>
      </div>

      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="addProduct()" class="add-btn">
          <mat-icon>add</mat-icon>
          Add Product
        </button>

        <button mat-icon-button (click)="refreshData()" matTooltip="Refresh Data">
          <mat-icon>refresh</mat-icon>
        </button>

        <button mat-icon-button (click)="exportData()" matTooltip="Export Data">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- ===== QUICK STATS CARDS ===== -->
  <div class="stats-cards">
    <mat-card class="stat-card total-products">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ formatNumber(statsData.totalProducts) }}</div>
          <div class="stat-label">Total Products</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card low-stock" *ngIf="statsData.lowStockCount > 0">
      <mat-card-content>
        <div class="stat-icon warning">
          <mat-icon>warning</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ statsData.lowStockCount }}</div>
          <div class="stat-label">Low Stock Items</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card value-card">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>trending_up</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ formatPercentage(statsData.averageMargin) }}</div>
          <div class="stat-label">Avg. Margin</div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- ===== FILTERS SECTION ===== -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="filterForm" class="filters-form">
        <div class="filter-row">
          <!-- Search -->
          <mat-form-field class="search-field" appearance="outline">
            <mat-label>Search products...</mat-label>
            <input matInput formControlName="search" placeholder="Name, barcode, or description"
              (keyup.enter)="loadProducts()">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <!-- Category Filter -->
          <mat-form-field class="category-filter" appearance="outline">
            <mat-label>Category</mat-label>
            <mat-select formControlName="categoryId" (click)="$event.stopPropagation()"
              (selectionChange)="onCategoryFilterChange($event)">
              <mat-option value="">All Categories</mat-option>
              <mat-option *ngFor="let category of categories; trackBy: trackCategoryById" [value]="category.id">
                <span class="category-option">
                  <span class="category-color" [style.background-color]="category.color"></span>
                  {{ category.name }}
                </span>
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- ✅ FIXED: Stock Filter with proper enum values -->
          <mat-form-field class="stock-filter" appearance="outline">
            <mat-label>Stock Status</mat-label>
            <mat-select formControlName="stockFilter">
              <mat-option *ngFor="let option of stockFilterOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Active Filter -->
          <mat-form-field class="status-filter" appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="isActive">
              <mat-option [value]="true">Active Only</mat-option>
              <mat-option [value]="false">Inactive Only</mat-option>
              <mat-option value="">All Products</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Clear Filters -->
          <button mat-icon-button (click)="clearFilters()" matTooltip="Clear Filters" class="clear-filters-btn">
            <mat-icon>clear</mat-icon>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- ===== RESPONSIVE INFO BAR ===== -->
  <div class="responsive-info" *ngIf="!isDesktopView">
    <mat-icon>info</mat-icon>
    <span *ngIf="isMobileView">Mobile view: Essential columns only</span>
    <span *ngIf="isTabletView">Tablet view: Core columns shown</span>
    <small>Switch to desktop for full table view</small>
  </div>

  <!-- ===== PRODUCTS TABLE ===== -->
  <mat-card class="table-card">
    <mat-card-content>
      <div class="table-container">
        <!-- ✅ FIXED: Dynamic columns based on screen size -->
        <table mat-table [dataSource]="products" matSort (matSortChange)="onSortChange($event)" class="products-table">

          <!-- Image Column - Desktop Only -->
          <ng-container matColumnDef="image">
            <th mat-header-cell *matHeaderCellDef class="image-col">Image</th>
            <td mat-cell *matCellDef="let product" class="image-col">
              <div class="product-image">
                <img [src]="product.imageUrl || '/assets/images/placeholder-product.png'" [alt]="product.name"
                  onerror="this.src='/assets/images/placeholder-product.png'">
              </div>
            </td>
          </ng-container>

          <!-- Product Info Column - Always Visible -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Product</th>
            <td mat-cell *matCellDef="let product" class="product-info">
              <div class="product-details">
                <div class="product-name">{{ product.name }}</div>
                <div class="product-meta">
                  <span class="barcode">{{ product.barcode }}</span>
                  <span class="unit">{{ product.unit }}</span>
                </div>
                <div class="product-description" *ngIf="product.description">
                  {{ product.description }}
                </div>

                <!-- ✅ Mobile: Show additional info in product card -->
                <div class="mobile-additional-info" *ngIf="isMobileView">
                  <div class="mobile-info-row">
                    <span class="mobile-label">Category:</span>
                    <mat-chip class="mobile-category-chip"
                      [style.background-color]="getCategoryColor(product.categoryId)">
                      {{ getCategoryName(product.categoryId) }}
                    </mat-chip>
                  </div>
                  <div class="mobile-info-row" *ngIf="isColumnVisible('buyPrice')">
                    <span class="mobile-label">Buy:</span>
                    <span class="mobile-value">{{ formatCurrency(product.buyPrice) }}</span>
                  </div>
                  <div class="mobile-info-row" *ngIf="isColumnVisible('sellPrice')">
                    <span class="mobile-label">Sell:</span>
                    <span class="mobile-value">{{ formatCurrency(product.sellPrice) }}</span>
                  </div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Barcode Column - Tablet+ -->
          <ng-container matColumnDef="barcode">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Barcode</th>
            <td mat-cell *matCellDef="let product">
              <span class="barcode-value">{{ product.barcode }}</span>
            </td>
          </ng-container>

          <!-- ✅ FIXED: Category Column - Add mat-sort-header -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="categoryName">Category</th>
            <td mat-cell *matCellDef="let product" class="category-info">
              <mat-chip class="category-chip" [style.background-color]="getCategoryColor(product.categoryId)"
                [style.color]="'white'">
                {{ getCategoryName(product.categoryId) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Stock Column - Always Visible -->
          <ng-container matColumnDef="stock">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Stock</th>
            <td mat-cell *matCellDef="let product" class="stock-info">
              <div class="stock-main">
                <span class="stock-value" [style.color]="getStockStatusColor(product)">
                  {{ formatNumber(product.stock) }}
                </span>
                <span class="stock-unit">{{ product.unit }}</span>
              </div>
              <div class="stock-status">
                <mat-chip class="status-chip" [style.background-color]="getStockStatusColor(product)"
                  [style.color]="'white'">
                  {{ getStockStatusLabel(product) }}
                </mat-chip>
              </div>

              <!-- ✅ Mobile: Show minimum stock info -->
              <div class="mobile-minimum-info" *ngIf="isMobileView && product.stock <= product.minimumStock">
                <mat-icon class="warning-icon" color="warn">warning</mat-icon>
                <span class="warning-text">Min: {{ formatNumber(product.minimumStock) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Minimum Stock Column - Desktop Only -->
          <ng-container matColumnDef="minimumStock">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Min. Stock</th>
            <td mat-cell *matCellDef="let product" class="minimum-stock-info">
              <div class="minimum-stock-main">
                <span class="minimum-value">{{ formatNumber(product.minimumStock || 0) }}</span>
                <span class="minimum-unit">{{ product.unit }}</span>
              </div>
              <div class="minimum-status" *ngIf="product.stock <= product.minimumStock">
                <mat-icon class="warning-icon" color="warn">warning</mat-icon>
                <span class="warning-text">Below minimum</span>
              </div>
            </td>
          </ng-container>

          <!-- Buy Price Column - Desktop Only -->
          <ng-container matColumnDef="buyPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Buy Price</th>
            <td mat-cell *matCellDef="let product" class="price-info">
              <span class="price-value">{{ formatCurrency(product.buyPrice) }}</span>
            </td>
          </ng-container>

          <!-- Sell Price Column - Tablet+ -->
          <ng-container matColumnDef="sellPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Sell Price</th>
            <td mat-cell *matCellDef="let product" class="price-info">
              <span class="price-value">{{ formatCurrency(product.sellPrice) }}</span>
            </td>
          </ng-container>

          <!-- Margin Column - Desktop Only -->
          <ng-container matColumnDef="margin">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="profitMargin">Margin</th>
            <td mat-cell *matCellDef="let product" class="margin-info">
              <div class="margin-details">
                <div class="margin-percentage" [class.positive]="getMarginPercentage(product) > 0"
                  [class.negative]="getMarginPercentage(product) < 0">
                  {{ formatPercentage(getMarginPercentage(product)) }}
                </div>
                <div class="margin-amount">
                  {{ formatCurrency(getMarginAmount(product)) }}
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Status Column - Tablet+ -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="isActive">Status</th>
            <td mat-cell *matCellDef="let product" class="status-info">
              <mat-slide-toggle [checked]="product.isActive" (change)="toggleProductStatus(product)" [color]="'primary'">
                {{ product.isActive ? 'Active' : 'Inactive' }}
              </mat-slide-toggle>
            </td>
          </ng-container>

          <!-- Actions Column - Always Visible -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let product" class="actions-info">
              <div class="action-buttons">
                <!-- ✅ Mobile: Show essential actions only -->
                <div class="mobile-actions" *ngIf="isMobileView">
                  <button mat-icon-button (click)="editProduct(product)" matTooltip="Edit" color="primary">
                    <mat-icon>edit</mat-icon>
                  </button>

                  <button mat-icon-button [matMenuTriggerFor]="mobileActionsMenu" matTooltip="More">
                    <mat-icon>more_vert</mat-icon>
                  </button>

                  <mat-menu #mobileActionsMenu="matMenu">
                    <button mat-menu-item (click)="manageStock(product)">
                      <mat-icon>inventory</mat-icon>
                      <span>Manage Stock</span>
                    </button>

                    <button mat-menu-item (click)="toggleProductStatus(product)" [class.activate]="!product.isActive"
                      [class.deactivate]="product.isActive">
                      <mat-icon>{{ product.isActive ? 'visibility_off' : 'visibility' }}</mat-icon>
                      <span>{{ product.isActive ? 'Deactivate' : 'Activate' }}</span>
                    </button>

                    <mat-divider></mat-divider>

                    <button mat-menu-item (click)="deleteProduct(product)" class="delete-action">
                      <mat-icon color="warn">delete</mat-icon>
                      <span>Delete Product</span>
                    </button>
                  </mat-menu>
                </div>

                <!-- ✅ Tablet/Desktop: Show all actions -->
                <div class="desktop-actions" *ngIf="!isMobileView">
                  <!-- Quick Stock Management -->
                  <button mat-icon-button (click)="manageStock(product)" matTooltip="Manage Stock" color="primary">
                    <mat-icon>inventory</mat-icon>
                  </button>

                  <!-- Edit Product -->
                  <button mat-icon-button (click)="editProduct(product)" matTooltip="Edit Product" color="accent">
                    <mat-icon>edit</mat-icon>
                  </button>

                  <!-- More Actions Menu -->
                  <button mat-icon-button [matMenuTriggerFor]="desktopActionsMenu" matTooltip="More Actions">
                    <mat-icon>more_vert</mat-icon>
                  </button>

                  <mat-menu #desktopActionsMenu="matMenu">
                    <button mat-menu-item (click)="editProduct(product)">
                      <mat-icon>edit</mat-icon>
                      <span>Edit Product</span>
                    </button>

                    <button mat-menu-item (click)="manageStock(product)">
                      <mat-icon>inventory</mat-icon>
                      <span>Manage Stock</span>
                    </button>

                    <mat-divider></mat-divider>

                    <button mat-menu-item (click)="toggleProductStatus(product)" [class.activate]="!product.isActive"
                      [class.deactivate]="product.isActive">
                      <mat-icon>{{ product.isActive ? 'visibility_off' : 'visibility' }}</mat-icon>
                      <span>{{ product.isActive ? 'Deactivate' : 'Activate' }}</span>
                    </button>

                    <button mat-menu-item (click)="deleteProduct(product)" class="delete-action">
                      <mat-icon color="warn">delete</mat-icon>
                      <span>Delete Product</span>
                    </button>
                  </mat-menu>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- ✅ FIXED: Dynamic table header and rows based on responsive columns -->
          <tr mat-header-row *matHeaderRowDef="currentDisplayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let product; columns: currentDisplayedColumns;"
            [class.low-stock-row]="product.isLowStock" [class.out-of-stock-row]="product.isOutOfStock"
            [class.inactive-row]="!product.isActive">
          </tr>
        </table>

        <!-- ===== LOADING STATE ===== -->
        <div class="loading-container" *ngIf="loading()">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading products...</p>
        </div>

        <!-- ===== EMPTY STATE ===== -->
        <div class="empty-state" *ngIf="!loading() && products.data.length === 0">
          <mat-icon class="empty-icon">inventory_2</mat-icon>
          <h3>No products found</h3>
          <p>Try adjusting your search criteria or add a new product.</p>
          <button mat-raised-button color="primary" (click)="addProduct()">
            <mat-icon>add</mat-icon>
            Add First Product
          </button>
        </div>
      </div>

      <!-- ===== PAGINATION ===== -->
      <mat-paginator [length]="totalItems()" [pageSize]="pageSize()" [pageSizeOptions]="[10, 25, 50, 100]"
        (page)="onPageChange($event)" showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>

  <!-- ===== DEBUG INFO (Development Only) ===== -->
  <div class="debug-info" *ngIf="false">
    <mat-card>
      <mat-card-content>
        <h4>Debug Info</h4>
        <p><strong>Screen Width:</strong> {{ screenWidth() }}px</p>
        <p><strong>View Type:</strong>
          <span *ngIf="isMobileView">Mobile</span>
          <span *ngIf="isTabletView">Tablet</span>
          <span *ngIf="isDesktopView">Desktop</span>
        </p>
        <p><strong>Displayed Columns:</strong> {{ currentDisplayedColumns.join(', ') }}</p>
        <p><strong>Total Products:</strong> {{ totalItems() }}</p>
        <p><strong>Low Stock Count:</strong> {{ statsData.lowStockCount }}</p>
      </mat-card-content>
    </mat-card>
  </div>
</div>