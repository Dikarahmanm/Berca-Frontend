<!-- membership-form.component.html -->
<!-- Fixed All Signals Errors - Compatible with TypeScript Component -->
<div class="membership-container">

    <!-- Header Section with Real-time Status -->
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">
                <span class="title-icon">{{ getFormIcon() }}</span>
                {{ getFormTitle() }}
                <span class="realtime-indicator" [class.active]="realtimeConnected()">
                    <span class="indicator-dot"></span>
                    {{ realtimeConnected() ? 'Live' : 'Offline' }}
                </span>
            </h1>
            <p class="page-subtitle" *ngIf="member">
                {{ member.memberNumber }} ‚Ä¢ {{ member.name }}
            </p>
        </div>

        <div class="header-actions">
            <button class="btn btn-outline" (click)="navigateBack()">
                <span class="btn-icon">‚Ü©</span>
                Back to List
            </button>

            <button class="btn btn-primary" *ngIf="isReadOnlyMode() && memberId" (click)="editMember()">
                <span class="btn-icon">‚úèÔ∏è</span>
                Edit Member
            </button>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading$()" class="loading-container">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading member data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error$() as error" class="error-container card">
        <div class="error-content">
            <span class="error-icon">‚ö†Ô∏è</span>
            <div class="error-message">
                <h3>Oops! Something went wrong</h3>
                <p>{{ error }}</p>
            </div>
            <button class="btn btn-primary" (click)="navigateBack()">
                <span class="btn-icon">‚Üª</span>
                Go Back
            </button>
        </div>
    </div>

    <!-- Form Content -->
    <div class="content-section" *ngIf="!loading$() && !error$()">

        <!-- Member Stats Card (View Mode Only) -->
        <div class="member-stats card" *ngIf="isReadOnlyMode() && member">
            <div class="stats-header">
                <h3 class="stats-title">
                    <span class="stats-icon">üìä</span>
                    Member Statistics
                </h3>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-icon">üÜî</div>
                    <div class="stat-content">
                        <div class="stat-label">Member Since</div>
                        <div class="stat-value">{{ formatDate(member.createdAt) }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon tier-icon" [attr.data-tier]="member.tier.toLowerCase()">
                        {{ getTierIcon(member.tier) }}
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Current Tier</div>
                        <div class="stat-value">{{ member.tier }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <div class="stat-label">Total Spent</div>
                        <div class="stat-value">{{ formatCurrency(member.totalSpent) }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-content">
                        <div class="stat-label">Available Points</div>
                        <div class="stat-value">{{ formatNumber(member.availablePoints) }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">üßæ</div>
                    <div class="stat-content">
                        <div class="stat-label">Total Transactions</div>
                        <div class="stat-value">{{ formatNumber(member.totalTransactions) }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <div class="stat-label">Last Transaction</div>
                        <div class="stat-value">{{ formatDate(member.lastTransactionDate) }}</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions" *ngIf="isReadOnlyMode()">
                <button class="btn btn-primary" 
                    (click)="router.navigate(['/dashboard/membership/points', member.id])">
                    <span class="btn-icon">‚≠ê</span>
                    Manage Points
                </button>

                <button class="btn btn-outline" (click)="editMember()">
                    <span class="btn-icon">‚úèÔ∏è</span>
                    Edit Member
                </button>
            </div>
        </div>

        <!-- Main Form -->
        <div class="form-container card">
            <form [formGroup]="memberForm" (ngSubmit)="onSubmit()" class="member-form">

                <!-- Personal Information Section -->
                <div class="form-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            <span class="section-icon">üë§</span>
                            Personal Information
                        </h3>
                    </div>

                    <div class="form-grid">
                        <!-- Full Name -->
                        <div class="form-field full-width">
                            <label class="field-label">Full Name *</label>
                            <div class="input-wrapper">
                                <input class="form-control" type="text" formControlName="name" 
                                    placeholder="Enter member's full name" [readonly]="isReadOnlyMode()">
                                <span class="field-icon">üë§</span>
                            </div>
                            <div class="field-error" *ngIf="isFieldInvalid('name')">
                                {{ getFieldError('name') }}
                            </div>
                        </div>

                        <!-- Phone Number -->
                        <div class="form-field">
                            <label class="field-label">Phone Number *</label>
                            <div class="input-wrapper">
                                <input class="form-control" type="tel" formControlName="phone" 
                                    placeholder="+62 812 3456 7890" [readonly]="isReadOnlyMode()">
                                <span class="field-icon">üìû</span>
                            </div>
                            <div class="field-error" *ngIf="isFieldInvalid('phone')">
                                {{ getFieldError('phone') }}
                            </div>
                            <div class="field-hint" *ngIf="phoneExists">
                                <span class="hint-icon">‚ö†Ô∏è</span>
                                This phone number is already registered
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="form-field">
                            <label class="field-label">Email Address *</label>
                            <div class="input-wrapper">
                                <input class="form-control" type="email" formControlName="email" 
                                    placeholder="member@example.com" [readonly]="isReadOnlyMode()">
                                <span class="field-icon">‚úâÔ∏è</span>
                            </div>
                            <div class="field-error" *ngIf="isFieldInvalid('email')">
                                {{ getFieldError('email') }}
                            </div>
                        </div>

                        <!-- Gender -->
                        <div class="form-field">
                            <label class="field-label">Gender *</label>
                            <div class="select-wrapper">
                                <select class="form-control" formControlName="gender" [disabled]="isReadOnlyMode()">
                                    <option value="" disabled>Select gender</option>
                                    <option *ngFor="let option of genderOptions" [value]="option.value">
                                        {{ option.icon }} {{ option.label }}
                                    </option>
                                </select>
                                <span class="select-icon">‚ñº</span>
                            </div>
                            <div class="field-error" *ngIf="isFieldInvalid('gender')">
                                {{ getFieldError('gender') }}
                            </div>
                        </div>

                        <!-- Date of Birth -->
                        <div class="form-field">
                            <label class="field-label">Date of Birth *</label>
                            <div class="input-wrapper">
                                <input class="form-control" type="date" formControlName="dateOfBirth"
                                    [readonly]="isReadOnlyMode()">
                                <span class="field-icon">üìÖ</span>
                            </div>
                            <div class="field-error" *ngIf="isFieldInvalid('dateOfBirth')">
                                {{ getFieldError('dateOfBirth') }}
                            </div>
                            <div class="field-hint" *ngIf="member && isReadOnlyMode()">
                                {{ getDisplayAge() }}
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="form-field full-width">
                            <label class="field-label">Address *</label>
                            <div class="input-wrapper">
                                <textarea class="form-control" formControlName="address" rows="3" 
                                    placeholder="Enter complete address" [readonly]="isReadOnlyMode()"></textarea>
                                <span class="field-icon">üè†</span>
                            </div>
                            <div class="field-error" *ngIf="isFieldInvalid('address')">
                                {{ getFieldError('address') }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Status Section (Edit Mode Only) -->
                <div class="form-section" *ngIf="canShowActiveToggle()">
                    <div class="section-header">
                        <h3 class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            Account Settings
                        </h3>
                    </div>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="field-label">Account Status</label>
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" formControlName="isActive">
                                    <span class="toggle-slider">
                                        <span class="toggle-text">
                                            {{ memberForm.get('isActive')?.value ? 'Active' : 'Inactive' }}
                                        </span>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Member Information Display (View Mode) -->
                <div class="form-section" *ngIf="isReadOnlyMode() && member">
                    <div class="section-header">
                        <h3 class="section-title">
                            <span class="section-icon">üìã</span>
                            Member Information
                        </h3>
                    </div>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Member Number</div>
                            <div class="info-value">
                                <span class="info-badge primary">{{ member.memberNumber }}</span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Member Tier</div>
                            <div class="info-value">
                                <span class="tier-badge" [attr.data-tier]="member.tier.toLowerCase()">
                                    {{ getTierIcon(member.tier) }} {{ member.tier }}
                                </span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Account Status</div>
                            <div class="info-value">
                                <span class="status-badge" [class.active]="member.isActive" [class.inactive]="!member.isActive">
                                    <span class="status-icon">{{ member.isActive ? '‚úÖ' : '‚ùå' }}</span>
                                    {{ member.isActive ? 'Active' : 'Inactive' }}
                                </span>
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Created At</div>
                            <div class="info-value">{{ formatDate(member.createdAt) }}</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">Last Updated</div>
                            <div class="info-value">{{ formatDate(member.updatedAt) }}</div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions" *ngIf="!isReadOnlyMode()">
                    <button class="btn btn-outline" type="button" (click)="navigateBack()">
                        <span class="btn-icon">‚úñ</span>
                        Cancel
                    </button>

                    <button class="btn btn-primary" type="submit" [disabled]="isSubmitButtonDisabled()">
                        <div class="loading-spinner" *ngIf="isSubmitting"></div>
                        <span class="btn-icon" *ngIf="!isSubmitting">üíæ</span>
                        {{ getSubmitButtonText() }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Floating Action Button (Mobile) -->
    <button class="fab" *ngIf="!isReadOnlyMode()" (click)="onSubmit()" title="Save member" [disabled]="isSubmitButtonDisabled()">
        <span class="fab-icon" *ngIf="!isSubmitting">üíæ</span>
        <div class="loading-spinner" *ngIf="isSubmitting"></div>
    </button>

</div>

<!-- Real-time Update Toast Notifications -->
<div class="toast-container">
    <div class="toast" *ngFor="let toast of realtimeToasts(); trackBy: trackByToast" [class]="'toast-' + toast.type">
        <div class="toast-content">
            <span class="toast-icon">{{ getToastIcon(toast.type) }}</span>
            <div class="toast-message">
                <div class="toast-title">{{ toast.title }}</div>
                <div class="toast-text">{{ toast.message }}</div>
            </div>
        </div>
        <button class="toast-close" (click)="dismissToast(toast.id)">√ó</button>
    </div>
</div>