<!-- membership-list.component.html -->
<!-- Clean Design - Similar to Inventory Layout -->
<div class="membership-container">

  <!-- Header Section with Stats -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <span class="title-icon">ğŸ‘¥</span>
        Member Management
        <span class="realtime-indicator" [class.active]="realtimeConnected()">
          <span class="indicator-dot"></span>
          {{ realtimeConnected() ? 'Live' : 'Offline' }}
        </span>
      </h1>
      <div class="subtitle-stats">
        <span class="stat-chip members">{{ filteredMembers().length }} Members</span>
        <span class="stat-chip active" *ngIf="activeMembersCount() > 0">{{ activeMembersCount() }} Active</span>
        <span class="stat-chip credit" *ngIf="creditEnabledCount() > 0">{{ creditEnabledCount() }} Credit Enabled</span>
      </div>
    </div>

    <div class="header-actions">
      <button class="btn btn-primary" (click)="createMember()">
        <span class="btn-icon">+</span>
        Add Member
      </button>

      <button class="btn btn-outline" (click)="toggleAdvancedFilters()">
        <span class="btn-icon">ğŸ”§</span>
        {{ showAdvancedFilters() ? 'Hide' : 'Advanced' }} Filters
      </button>

      <button class="btn btn-outline" [disabled]="selectedMembers().length === 0" (click)="toggleBulkMenu()">
        <span class="btn-icon">âš™</span>
        Actions ({{selectedMembers().length}})
      </button>
    </div>
  </div>

  <!-- Enhanced Quick Stats Cards -->
  <div class="stats-cards">
    <div class="stat-card total-members">
      <div class="stat-icon">
        <span class="icon">ğŸ‘¥</span>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ memberStats().totalMembers }}</div>
        <div class="stat-label">Total Members</div>
      </div>
    </div>

    <div class="stat-card active-members">
      <div class="stat-icon success">
        <span class="icon">âœ…</span>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ memberStats().activeMembers }}</div>
        <div class="stat-label">Active Members</div>
      </div>
    </div>

    <div class="stat-card credit-enabled" *ngIf="memberStats().creditEnabledMembers > 0">
      <div class="stat-icon credit">
        <span class="icon">ğŸ’³</span>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ memberStats().creditEnabledMembers }}</div>
        <div class="stat-label">Credit Enabled</div>
      </div>
    </div>

    <div class="stat-card vip-members" *ngIf="memberStats().vipMembers > 0">
      <div class="stat-icon vip">
        <span class="icon">â­</span>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ memberStats().vipMembers }}</div>
        <div class="stat-label">VIP Members</div>
      </div>
    </div>

    <div class="stat-card total-points">
      <div class="stat-icon points">
        <span class="icon">ğŸ†</span>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ formatCompactNumber(memberStats().totalPoints) }}</div>
        <div class="stat-label">Total Points</div>
      </div>
    </div>
  </div>

  <!-- Enhanced Search & Filters -->
  <div class="search-section card" [formGroup]="searchForm">
    <!-- Basic Search -->
    <div class="search-grid">
      <div class="search-field">
        <input type="text" placeholder="Search members..." formControlName="search" class="form-control" />
        <span class="search-icon">ğŸ”</span>
      </div>

      <div class="filter-field">
        <select class="form-control" formControlName="isActive">
          <option value="all">All Status</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
      </div>

      <div class="filter-field">
        <select class="form-control" formControlName="tier">
          <option value="all">All Tiers</option>
          <option value="Bronze">Bronze</option>
          <option value="Silver">Silver</option>
          <option value="Gold">Gold</option>
          <option value="Platinum">Platinum</option>
          <option value="VIP">VIP</option>
        </select>
      </div>

      <button class="btn btn-outline" (click)="onFilterReset()">
        <span class="btn-icon">â†»</span>
        Reset
      </button>
    </div>

    <!-- Advanced Filters (Collapsible) -->
    <div class="advanced-filters" *ngIf="showAdvancedFilters()">
      <div class="advanced-filters-grid">
        <!-- Date Range Filter -->
        <div class="filter-group">
          <label class="filter-label">Registration Date</label>
          <div class="date-range">
            <input type="date" class="form-control" formControlName="registrationStartDate" placeholder="From" />
            <span class="date-separator">to</span>
            <input type="date" class="form-control" formControlName="registrationEndDate" placeholder="To" />
          </div>
        </div>

        <!-- Points Range Filter -->
        <div class="filter-group">
          <label class="filter-label">Points Range</label>
          <div class="range-inputs">
            <input type="number" class="form-control" formControlName="minPoints" placeholder="Min Points" min="0" />
            <span class="range-separator">to</span>
            <input type="number" class="form-control" formControlName="maxPoints" placeholder="Max Points" min="0" />
          </div>
        </div>

        <!-- Credit Status Filter -->
        <div class="filter-group">
          <label class="filter-label">Credit Status</label>
          <select class="form-control" formControlName="creditStatus">
            <option value="all">All Credit Status</option>
            <option value="enabled">Credit Enabled</option>
            <option value="disabled">No Credit</option>
            <option value="blocked">Credit Blocked</option>
          </select>
        </div>

        <!-- Risk Level Filter -->
        <div class="filter-group">
          <label class="filter-label">Risk Level</label>
          <select class="form-control" formControlName="riskLevel">
            <option value="all">All Risk Levels</option>
            <option value="Low">Low Risk</option>
            <option value="Medium">Medium Risk</option>
            <option value="High">High Risk</option>
            <option value="Critical">Critical Risk</option>
          </select>
        </div>
      </div>

      <div class="advanced-actions">
        <button class="btn btn-primary" (click)="applyAdvancedFilters()">
          <span class="btn-icon">ğŸ”</span>
          Apply Filters
        </button>
        <button class="btn btn-ghost" (click)="clearAdvancedFilters()">
          <span class="btn-icon">â†»</span>
          Reset Advanced
        </button>
      </div>
    </div>
  </div>

  <!-- Bulk Actions Menu -->
  <div class="bulk-menu" *ngIf="showBulkActionsMenu() && selectedMembers().length > 0">
    <div class="bulk-menu-content">
      <h4 class="bulk-menu-title">
        <span class="bulk-icon">âš™</span>
        Bulk Actions ({{ selectedMembers().length }} selected)
      </h4>
      
      <div class="bulk-actions-grid">
        <button class="bulk-action-btn activate" (click)="bulkActivateMembers()">
          <span class="action-icon">âœ…</span>
          <span class="action-label">Activate</span>
        </button>
        
        <button class="bulk-action-btn deactivate" (click)="bulkDeactivateMembers()">
          <span class="action-icon">âŒ</span>
          <span class="action-label">Deactivate</span>
        </button>
        
        <button class="bulk-action-btn credit" (click)="bulkGrantCredit()">
          <span class="action-icon">ğŸ’³</span>
          <span class="action-label">Grant Credit</span>
        </button>
        
        <button class="bulk-action-btn export" (click)="bulkExportMembers()">
          <span class="action-icon">ğŸ“Š</span>
          <span class="action-label">Export Data</span>
        </button>
      </div>
      
      <button class="bulk-close-btn" (click)="closeBulkMenu()">
        <span class="close-icon">âœ–</span>
        Close
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading$()">
    <div class="loading-spinner"></div>
    <p class="loading-message">Loading members...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error$() && !loading$()">
    <div class="error-content">
      <span class="error-icon">âš ï¸</span>
      <h3 class="error-title">Error Loading Members</h3>
      <p class="error-message">{{ error$() }}</p>
      <button class="btn btn-primary" (click)="loadMembers()">
        <span class="btn-icon">ğŸ”„</span>
        Try Again
      </button>
    </div>
  </div>

  <!-- Mobile View (Card Layout) -->
  <div class="mobile-view" *ngIf="!loading$() && !error$() && isMobileView()">
    <div class="mobile-members-grid">
      <div class="member-card" *ngFor="let member of dataSource().data; trackBy: trackByMember" 
           [class.selected]="isSelected(member)" [class.recent-update]="isRecentlyUpdated(member)">
        
        <!-- Selection Checkbox -->
        <div class="card-selection">
          <input type="checkbox" [checked]="isSelected(member)" (change)="toggleSelection(member)" 
                 (click)="$event.stopPropagation()" class="selection-checkbox">
        </div>

        <!-- Member Info -->
        <div class="card-content" (click)="showMemberDetail(member)">
          <div class="member-header">
            <div class="member-avatar">
              <span class="avatar-icon">{{ getAvatarIcon(member.tier) }}</span>
            </div>
            <div class="member-basic">
              <h3 class="member-name">{{ member.name }}</h3>
              <span class="member-number">{{ member.memberNumber }}</span>
            </div>
            <div class="member-tier">
              <span class="tier-badge" [attr.data-tier]="member.tier.toLowerCase()">
                {{ member.tier }}
              </span>
            </div>
          </div>

          <div class="member-details">
            <div class="detail-row">
              <span class="detail-label">Contact:</span>
              <span class="detail-value">{{ member.phone }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Points:</span>
              <span class="detail-value">{{ formatNumber(member.availablePoints) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Credit:</span>
              <span class="detail-value credit-value" [class.has-credit]="member.creditLimit > 0">
                {{ member.creditLimit > 0 ? formatCurrency(member.creditLimit) : 'No Credit' }}
              </span>
            </div>
          </div>

          <div class="member-status">
            <div class="status-indicators">
              <span class="status-badge" [class.active]="member.isActive" [class.inactive]="!member.isActive">
                {{ member.isActive ? 'Active' : 'Inactive' }}
              </span>
              <span class="credit-status" *ngIf="member.creditLimit > 0" [attr.data-risk]="member.riskLevel.toLowerCase()">
                {{ member.statusDescription }}
              </span>
            </div>
            
            <div class="last-activity">
              <span class="activity-label">Last seen:</span>
              <span class="activity-date">{{ formatDate(member.lastTransactionDate) }}</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card-actions">
          <button class="action-btn edit" (click)="editMember(member)" title="Edit Member">
            <span class="action-icon">âœï¸</span>
          </button>
          <button class="action-btn credit" (click)="manageMemberCredit(member)" title="Manage Credit" 
                  [class.has-credit]="member.creditLimit > 0">
            <span class="action-icon">ğŸ’³</span>
          </button>
          <button class="action-btn status" (click)="toggleMemberStatus(member)" 
                  [title]="member.isActive ? 'Deactivate' : 'Activate'">
            <span class="action-icon">{{ member.isActive ? 'âŒ' : 'âœ…' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Desktop View (Table Layout) -->
  <div class="desktop-view" *ngIf="!loading$() && !error$() && isDesktopView()">
    <div class="table-container">
      <div class="members-table-wrapper">
        <!-- Clean Div-Based Table Layout -->
        <div class="members-table-container">
          
          <!-- Table Header -->
          <div class="table-header">
            <div class="header-row">
              
              <!-- Selection Column -->
              <div class="header-cell checkbox-column">
                <input type="checkbox" [checked]="isAllSelected()" [indeterminate]="isPartiallySelected()" 
                       (change)="selectAll()" class="header-checkbox">
              </div>

              <!-- Member Number Column -->
              <div class="header-cell member-number-column sortable" (click)="sortBy('memberNumber')">
                <div class="header-content">
                  <span class="header-icon">ğŸ†”</span>
                  <span class="header-label">Member #</span>
                  <span class="sort-indicator" [attr.data-direction]="getSortDirection('memberNumber')">
                    {{ getSortIcon('memberNumber') }}
                  </span>
                </div>
              </div>

              <!-- Member Info Column -->
              <div class="header-cell member-info-column sortable" (click)="sortBy('name')">
                <div class="header-content">
                  <span class="header-icon">ğŸ‘¤</span>
                  <span class="header-label">Member Information</span>
                  <span class="sort-indicator" [attr.data-direction]="getSortDirection('name')">
                    {{ getSortIcon('name') }}
                  </span>
                </div>
              </div>

              <!-- Tier Column -->
              <div class="header-cell tier-column sortable" (click)="sortBy('tier')">
                <div class="header-content">
                  <span class="header-icon">ğŸ†</span>
                  <span class="header-label">Tier & Points</span>
                  <span class="sort-indicator" [attr.data-direction]="getSortDirection('tier')">
                    {{ getSortIcon('tier') }}
                  </span>
                </div>
              </div>

              <!-- Credit Status Column -->
              <div class="header-cell credit-column sortable" (click)="sortBy('creditLimit')">
                <div class="header-content">
                  <span class="header-icon">ğŸ’³</span>
                  <span class="header-label">Credit Status</span>
                  <span class="sort-indicator" [attr.data-direction]="getSortDirection('creditLimit')">
                    {{ getSortIcon('creditLimit') }}
                  </span>
                </div>
              </div>

              <!-- Status Column -->
              <div class="header-cell status-column sortable" (click)="sortBy('isActive')">
                <div class="header-content">
                  <span class="header-icon">ğŸ”„</span>
                  <span class="header-label">Status</span>
                  <span class="sort-indicator" [attr.data-direction]="getSortDirection('isActive')">
                    {{ getSortIcon('isActive') }}
                  </span>
                </div>
              </div>

              <!-- Actions Column -->
              <div class="header-cell actions-column">
                <div class="header-content">
                  <span class="header-icon">âš¡</span>
                  <span class="header-label">Actions</span>
                </div>
              </div>

            </div>
          </div>

          <!-- Table Body -->
          <div class="table-body">
            <div 
              *ngFor="let member of filteredMembers(); trackBy: trackByMember" 
              class="member-row"
              [class.selected]="isSelected(member)" 
              [class.recent-update]="isRecentlyUpdated(member)">

              <!-- Selection Cell -->
              <div class="data-cell checkbox-column">
                <input type="checkbox" [checked]="isSelected(member)" (change)="toggleSelection(member)"
                       (click)="$event.stopPropagation()" class="row-checkbox">
              </div>

              <!-- Member Number Cell -->
              <div class="data-cell member-number-column">
                <div class="member-number-content">
                  <span class="member-number-badge">
                    <span class="number-icon">ğŸ†”</span>
                    <span class="number-text">{{ member.memberNumber }}</span>
                  </span>
                  <span class="update-indicator" *ngIf="isRecentlyUpdated(member)" title="Recently updated">
                    ğŸ†•
                  </span>
                </div>
              </div>

              <!-- Member Info Cell -->
              <div class="data-cell member-info-column">
                <div class="member-info-content">
                  <div class="member-name">{{ member.name }}</div>
                  <div class="member-contact">
                    <div class="contact-item phone">
                      <span class="contact-icon">ğŸ“</span>
                      <span class="contact-text">{{ member.phone }}</span>
                    </div>
                    <div class="contact-item email" *ngIf="member.email">
                      <span class="contact-icon">âœ‰ï¸</span>
                      <span class="contact-text">{{ member.email }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Tier & Points Cell -->
              <div class="data-cell tier-column">
                <div class="tier-content">
                  <!-- Tier Badge -->
                  <div class="tier-badge" [attr.data-tier]="member.tier.toLowerCase()">
                    <span class="tier-icon">{{ getTierIcon(member.tier) }}</span>
                    <span class="tier-name">{{ member.tier }}</span>
                  </div>
                  
                  <!-- Points Information -->
                  <div class="points-info">
                    <div class="available-points">
                      <span class="points-icon">â­</span>
                      <span class="points-value">{{ formatNumber(member.availablePoints) }}</span>
                      <span class="points-label">available</span>
                    </div>
                    <div class="total-points">
                      <span class="total-text">Total: {{ formatNumber(member.totalPoints) }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Credit Status Cell -->
              <div class="data-cell credit-column">
                <div class="credit-content">
                  <div class="credit-info" *ngIf="member.creditLimit > 0; else noCredit">
                    
                    <!-- Credit Limit -->
                    <div class="credit-limit-info">
                      <span class="credit-icon">ğŸ’³</span>
                      <span class="credit-amount">{{ formatCurrency(member.creditLimit) }}</span>
                      <span class="limit-label">limit</span>
                    </div>
                    
                    <!-- Credit Status -->
                    <div class="credit-status" [attr.data-risk]="member.riskLevel?.toLowerCase()">
                      <span class="status-text">{{ member.statusDescription }}</span>
                      <span class="risk-badge" [attr.data-risk]="member.riskLevel?.toLowerCase()">
                        {{ member.riskLevel }}
                      </span>
                    </div>
                    
                    <!-- Credit Usage (if any debt) -->
                    <div class="credit-usage" *ngIf="member.currentDebt > 0">
                      <span class="usage-text">Used: {{ formatCurrency(member.currentDebt) }}</span>
                      <span class="usage-percentage">({{ getUtilizationPercentage(member) }}%)</span>
                    </div>
                    
                  </div>
                  <ng-template #noCredit>
                    <div class="no-credit-info">
                      <span class="no-credit-icon">ğŸš«</span>
                      <span class="no-credit-text">No Credit</span>
                    </div>
                  </ng-template>
                </div>
              </div>

              <!-- Status Cell -->
              <div class="data-cell status-column">
                <div class="status-content">
                  <!-- Active/Inactive Status -->
                  <div class="member-status">
                    <span class="status-badge" [class.active]="member.isActive" [class.inactive]="!member.isActive">
                      <span class="status-icon">{{ member.isActive ? 'âœ…' : 'âŒ' }}</span>
                      <span class="status-text">{{ member.isActive ? 'Active' : 'Inactive' }}</span>
                    </span>
                  </div>
                  
                  <!-- Last Activity -->
                  <div class="last-activity">
                    <span class="activity-label">Last seen:</span>
                    <span class="activity-date">{{ formatDate(member.lastTransactionDate) }}</span>
                  </div>
                </div>
              </div>

              <!-- Actions Cell -->
              <div class="data-cell actions-column">
                <div class="actions-content">
                  
                  <!-- Primary Actions -->
                  <div class="primary-actions">
                    <button class="action-btn edit-btn" (click)="editMember(member)" title="Edit Member">
                      <span class="btn-icon">âœï¸</span>
                      <span class="btn-text">Edit</span>
                    </button>

                    <button class="action-btn credit-btn" (click)="manageMemberCredit(member)" 
                            [title]="member.creditLimit > 0 ? 'Manage Credit (Limit: ' + formatCurrency(member.creditLimit) + ')' : 'Enable Credit'"
                            [class.has-credit]="member.creditLimit > 0">
                      <span class="btn-icon">ğŸ“‹</span>
                      <span class="btn-text">Credit</span>
                    </button>
                  </div>

                  <!-- Secondary Actions -->
                  <div class="secondary-actions">
                    <button class="action-btn status-btn" (click)="toggleMemberStatus(member)"
                            [title]="member.isActive ? 'Deactivate Member' : 'Activate Member'"
                            [class.active]="member.isActive">
                      <span class="btn-icon">{{ member.isActive ? 'âŒ' : 'âœ…' }}</span>
                      <span class="btn-text">{{ member.isActive ? 'Deactivate' : 'Activate' }}</span>
                    </button>

                    <!-- More Actions Menu -->
                    <div class="more-actions">
                      <button class="action-btn more-btn" (click)="toggleMemberActions(member.id)" title="More Actions">
                        <span class="btn-icon">â‹®</span>
                      </button>
                      <div class="actions-menu" *ngIf="showMemberActions() === member.id">
                        <button class="menu-item" (click)="viewMemberHistory(member)">
                          <span class="item-icon">ğŸ“Š</span>
                          <span class="item-text">View History</span>
                        </button>
                        <button class="menu-item" (click)="exportMemberData(member)">
                          <span class="item-icon">ğŸ“‹</span>
                          <span class="item-text">Export Data</span>
                        </button>
                        <div class="menu-divider"></div>
                        <button class="menu-item danger" (click)="deleteMember(member)" *ngIf="!member.isActive">
                          <span class="item-icon">ğŸ—‘ï¸</span>
                          <span class="item-text">Delete Member</span>
                        </button>
                      </div>
                    </div>
                  </div>
                  
                </div>
              </div>

            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="filteredMembers().length === 0">
              <div class="empty-content">
                <span class="empty-icon">ğŸ‘¥</span>
                <h3 class="empty-title">No Members Found</h3>
                <p class="empty-message">{{ getEmptyStateMessage() }}</p>
                <button class="btn btn-primary" (click)="createMember()">
                  <span class="btn-icon">+</span>
                  Add First Member
                </button>
              </div>
            </div>

          </div>
          
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-wrapper" *ngIf="dataSource().totalPages > 1">
      <div class="pagination-info">
        Showing {{ dataSource().startItem }} to {{ dataSource().endItem }} 
        of {{ dataSource().totalItems }} members
      </div>
      
      <div class="pagination-controls">
        <button class="pagination-btn" (click)="goToFirstPage()" 
                [disabled]="dataSource().currentPage === 1" title="First Page">
          <span class="btn-icon">â®</span>
        </button>
        
        <button class="pagination-btn" (click)="goToPreviousPage()" 
                [disabled]="dataSource().currentPage === 1" title="Previous Page">
          <span class="btn-icon">â—€</span>
        </button>
        
        <span class="page-numbers">
          <span class="page-number" *ngFor="let page of getPageNumbers()" 
                [class.current]="page === dataSource().currentPage"
                [class.ellipsis]="page === -1"
                (click)="page !== -1 && goToPage(page)">
            {{ page === -1 ? '...' : page }}
          </span>
        </span>
        
        <button class="pagination-btn" (click)="goToNextPage()" 
                [disabled]="dataSource().currentPage === dataSource().totalPages" title="Next Page">
          <span class="btn-icon">â–¶</span>
        </button>
        
        <button class="pagination-btn" (click)="goToLastPage()" 
                [disabled]="dataSource().currentPage === dataSource().totalPages" title="Last Page">
          <span class="btn-icon">â­</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Floating Action Button (Mobile) -->
  <button class="fab" (click)="createMember()" title="Add new member">
    <span class="fab-icon">+</span>
  </button>

</div>

<!-- Credit Management Modal -->
<div class="modal-backdrop" *ngIf="showCreditModal()">
  <div class="modal-dialog">
    <div class="modal-header">
      <h2 class="modal-title">
        <span class="modal-icon">ğŸ’³</span>
        Credit Management - {{ selectedMemberForCredit()?.name }}
      </h2>
      <button class="modal-close" (click)="closeCreditModal()">
        <span class="close-icon">Ã—</span>
      </button>
    </div>

    <div class="modal-body">
      <!-- Member Credit Summary -->
      <div class="credit-summary-section">
        <h3 class="section-title">Current Credit Status</h3>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="summary-label">Credit Limit:</span>
            <span class="summary-value">{{ formatCurrency(selectedMemberForCredit()?.creditLimit || 0) }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Current Debt:</span>
            <span class="summary-value">{{ formatCurrency(selectedMemberForCredit()?.currentDebt || 0) }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Available Credit:</span>
            <span class="summary-value">{{ formatCurrency(selectedMemberForCredit()?.availableCredit || 0) }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Risk Level:</span>
            <span class="summary-value risk-level" [attr.data-risk]="selectedMemberForCredit()?.riskLevel?.toLowerCase()">
              {{ selectedMemberForCredit()?.riskLevel }}
            </span>
          </div>
        </div>
      </div>

      <!-- Credit Limit Management -->
      <div class="credit-action-section">
        <div class="action-header">
          <h4 class="action-title">
            <span class="action-icon">ğŸ“Š</span>
            Update Credit Limit
          </h4>
          <div class="action-description">
            Set or modify the member's credit limit. Higher amounts may require approval.
          </div>
        </div>
        <div class="action-controls">
          <div class="form-field">
            <label>New Credit Limit</label>
            <input type="number" class="form-control" [(ngModel)]="creditLimitAmount" 
                   [placeholder]="formatCurrency(selectedMemberForCredit()!.creditLimit)" min="0" max="50000000">
          </div>
          <div class="form-field">
            <label>Reason</label>
            <input type="text" class="form-control" [(ngModel)]="creditLimitReason" 
                   placeholder="e.g., Good payment history, Business expansion">
          </div>
          <button class="btn btn-primary" (click)="updateCreditLimit()" 
                  [disabled]="!creditLimitAmount || !creditLimitReason">
            {{ selectedMemberForCredit()!.creditLimit > 0 ? 'Update Limit' : 'Enable Credit' }}
          </button>
        </div>
      </div>

      <!-- Credit Grant -->
      <div class="credit-action-section">
        <div class="action-header">
          <h4 class="action-title">
            <span class="action-icon">ğŸ</span>
            Grant Additional Credit
          </h4>
          <div class="action-description">
            Grant bonus credit or increase available credit without changing the limit.
          </div>
        </div>
        <div class="action-controls">
          <div class="form-field">
            <label>Credit Amount</label>
            <input type="number" class="form-control" [(ngModel)]="grantCreditAmount" 
                   placeholder="Enter amount to grant" min="1000" max="10000000">
          </div>
          <div class="form-field">
            <label>Credit Type</label>
            <select class="form-control" [(ngModel)]="grantCreditType">
              <option value="Bonus_Credit">Bonus Credit</option>
              <option value="Limit_Increase">Limit Increase</option>
              <option value="Adjustment">Adjustment</option>
            </select>
          </div>
          <div class="form-field">
            <label>Description</label>
            <input type="text" class="form-control" [(ngModel)]="grantCreditDescription" 
                   placeholder="e.g., Loyalty bonus, Special promotion">
          </div>
          <button class="btn btn-accent" (click)="grantCredit()" 
                  [disabled]="!grantCreditAmount || !grantCreditDescription">
            Grant Credit
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeCreditModal()">
        Cancel
      </button>
      <button class="btn btn-secondary" (click)="viewCreditHistory()">
        View History
      </button>
    </div>
  </div>
</div>

<!-- Real-time Update Toast Notifications -->
<div class="toast-container">
  <div class="toast" *ngFor="let toast of realtimeToasts(); trackBy: trackByToast" [class]="'toast-' + toast.type">
    <div class="toast-content">
      <span class="toast-icon">{{ getToastIcon(toast.type) }}</span>
      <div class="toast-message">
        <div class="toast-title">{{ toast.title }}</div>
        <div class="toast-text">{{ toast.message }}</div>
      </div>
    </div>
    <button class="toast-close" (click)="dismissToast(toast.id)">Ã—</button>
  </div>
</div>