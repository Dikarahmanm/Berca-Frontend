<!-- src/app/modules/notifications/notification-center/notification-center.component.html -->
<app-base-layout 
  pageTitle="Notifications" 
  pageSubtitle="Pusat Notifikasi Toko Eniwan"
  [showPageHeader]="false"
  [isLoading]="isLoading"
  loadingMessage="Loading notifications...">

<div class="notification-center">
    <!-- Header -->
    <div class="notification-header">
        <div class="header-content">
            <h1 class="notification-title">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                </svg>
                Pusat Notifikasi
            </h1>
            <div class="header-actions">
                <button class="icon-button" (click)="refresh()" [disabled]="isLoading" title="Refresh">
                    <svg class="icon" [class.spinning]="isLoading" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                    </svg>
                </button>
                <button class="primary-button" (click)="markAllAsRead()" *ngIf="(summary?.unreadCount || 0) > 0">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z" />
                    </svg>
                    Tandai Semua Dibaca
                </button>
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="notification-summary" *ngIf="summary">
            <div class="summary-card">
                <div class="summary-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                    </svg>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{summary.totalCount}}</span>
                    <span class="summary-label">Total</span>
                </div>
            </div>
            <div class="summary-card unread" *ngIf="summary.unreadCount > 0">
                <div class="summary-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M7.58 4.08L6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42zm12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42zM18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2v-5z" />
                    </svg>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{summary.unreadCount}}</span>
                    <span class="summary-label">Belum Dibaca</span>
                </div>
            </div>
            <div class="summary-card low-stock" *ngIf="getLowStockCount() > 0">
                <div class="summary-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zM19 20H5V9h14v11z" />
                    </svg>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{getLowStockCount()}}</span>
                    <span class="summary-label">Stok Menipis</span>
                </div>
            </div>
            <div class="summary-card system" *ngIf="getSystemCount() > 0">
                <div class="summary-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
                    </svg>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{getSystemCount()}}</span>
                    <span class="summary-label">Sistem</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Alert -->
    <div class="error-alert" *ngIf="error">
        <div class="error-card">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
            </svg>
            <span>{{error}}</span>
            <button class="icon-button close-btn" (click)="clearError()" title="Tutup">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Filter Tabs -->
    <div class="notification-filters">
        <div class="filter-tabs">
            <button *ngFor="let filter of filterOptions; index as i" class="filter-tab"
                [class.active]="selectedFilterIndex === i" (click)="changeFilter(filter.value, i)">
                <div class="filter-label">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                    </svg>
                    <span>{{filter.label}}</span>
                    <span class="filter-count" *ngIf="filter.count > 0">{{filter.count}}</span>
                </div>
            </button>
        </div>
    </div>

    <!-- Notification List -->
    <div class="notification-content">
        <div class="loading-container" *ngIf="isLoading && notifications.length === 0">
            <div class="spinner">
                <div class="spinner-ring"></div>
            </div>
            <p>Memuat notifikasi...</p>
        </div>

        <div class="notification-list" *ngIf="!isLoading || notifications.length > 0">
            <!-- Empty State -->
            <div class="empty-state" *ngIf="!hasNotifications() && !isLoading">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M20 18.69L7.84 6.14 5.27 3.49 4 4.76l2.8 2.8v.01c-.52.99-.8 2.16-.8 3.42v6l-2 2v1h13.73l2 2L21 20.76l-1-2.07zM12 22c1.11 0 2-.89 2-2h-4c0 1.11.89 2 2 2zm6-7.32V11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.15.03-.29.08-.42.12-.1.03-.2.07-.3.11l7.99 7.99.23-.22z" />
                </svg>
                <h3>{{getEmptyStateMessage()}}</h3>
                <p>Notifikasi akan muncul di sini ketika ada aktivitas baru</p>
                <button class="primary-button" (click)="refresh()">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                    </svg>
                    Refresh
                </button>
            </div>

            <!-- Notification Cards -->
            <div class="notification-item"
                *ngFor="let notification of getFilteredNotifications(); trackBy: trackByNotificationId" [ngClass]="[
                    !notification.isRead ? 'unread' : '',
                    isNotificationExpired(notification) ? 'expired' : '',
                    getNotificationPriorityClass(notification)
                ]" (click)="onNotificationClick(notification)">

                <div class="notification-card">
                    <div class="notification-main">
                        <div class="notification-icon" [style.background-color]="getNotificationColor(notification)">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                            </svg>
                        </div>

                        <div class="notification-content-wrapper">
                            <div class="notification-header-info">
                                <h4 class="notification-title-text">{{notification.title}}</h4>
                                <span class="notification-type">{{getNotificationTypeLabel(notification.type)}}</span>
                            </div>

                            <p class="notification-message">{{notification.message}}</p>

                            <div class="notification-meta">
                                <span
                                    class="notification-time">{{formatNotificationTime(notification.createdAt)}}</span>
                                <span class="notification-priority priority-{{notification.priority.toLowerCase()}}">
                                    {{notification.priority}}
                                </span>
                            </div>
                        </div>

                        <div class="notification-actions">
                            <div class="unread-indicator" *ngIf="!notification.isRead"></div>
                            <button class="icon-button delete-btn" (click)="deleteNotification(notification, $event)"
                                title="Hapus notifikasi">
                                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="notification-action-button" *ngIf="notification.actionUrl">
                        <button class="secondary-button" (click)="onNotificationClick(notification)">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z" />
                            </svg>
                            Lihat Detail
                        </button>
                    </div>

                    <div class="expired-badge" *ngIf="isNotificationExpired(notification)">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" />
                        </svg>
                        Kedaluwarsa
                    </div>
                </div>
            </div>

            <!-- Load More Button -->
            <div class="load-more-container" *ngIf="hasMoreNotifications && hasNotifications()">
                <button class="secondary-button load-more-btn" (click)="loadMore()" [disabled]="isLoading">
                    <div class="spinner" *ngIf="isLoading">
                        <div class="spinner-ring small"></div>
                    </div>
                    <svg class="icon" *ngIf="!isLoading" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
                    </svg>
                    {{isLoading ? 'Memuat...' : 'Muat Lebih Banyak'}}
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="notification-footer" *ngIf="summary?.lastUpdated">
        <span class="last-updated">
            Terakhir diperbarui: {{summary?.lastUpdated | date:'dd/MM/yyyy HH:mm'}}
        </span>
    </div>
</div>

</app-base-layout>