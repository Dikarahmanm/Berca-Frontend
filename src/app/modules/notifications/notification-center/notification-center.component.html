<!-- src/app/modules/notifications/notification-center/notification-center.component.html -->
<app-base-layout 
  pageTitle="Notifications" 
  pageSubtitle="Pusat Notifikasi Toko Eniwan"
  [showPageHeader]="false"
  [isLoading]="isLoading"
  loadingMessage="Loading notifications...">

<div class="notification-center">
    <!-- Header -->
    <div class="notification-header">
        <div class="header-content">
            <h1 class="notification-title">
                <mat-icon class="title-icon">notifications</mat-icon>
                Pusat Notifikasi
            </h1>
            <div class="header-actions">
                <button class="icon-button" (click)="refresh()" [disabled]="isLoading" title="Refresh">
                    <mat-icon [class.spinning]="isLoading">refresh</mat-icon>
                </button>
                <button class="primary-button" (click)="markAllAsRead()" *ngIf="(summary?.unreadCount || 0) > 0">
                    <mat-icon>done_all</mat-icon>
                    Tandai Semua Dibaca
                </button>
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="notification-summary" *ngIf="summary">
            <div class="summary-card">
                <div class="summary-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                    </svg>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{summary.totalCount}}</span>
                    <span class="summary-label">Total</span>
                </div>
            </div>
            <div class="summary-card unread" *ngIf="summary.unreadCount > 0">
                <div class="summary-icon">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M7.58 4.08L6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42zm12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42zM18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2v-5z" />
                    </svg>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{summary.unreadCount}}</span>
                    <span class="summary-label">Belum Dibaca</span>
                </div>
            </div>
            <div class="summary-card low-stock" *ngIf="getLowStockCount() > 0">
                <div class="summary-icon">
                    <mat-icon>inventory_2</mat-icon>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{getLowStockCount()}}</span>
                    <span class="summary-label">Stok Menipis</span>
                </div>
            </div>
            <div class="summary-card system" *ngIf="getSystemCount() > 0">
                <div class="summary-icon">
                    <mat-icon>settings</mat-icon>
                </div>
                <div class="summary-content">
                    <span class="summary-count">{{getSystemCount()}}</span>
                    <span class="summary-label">Sistem</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Alert -->
    <div class="error-alert" *ngIf="error">
        <div class="error-card">
            <mat-icon>error</mat-icon>
            <span>{{error}}</span>
            <button class="icon-button close-btn" (click)="clearError()" title="Tutup">
                <mat-icon>close</mat-icon>
            </button>
        </div>
    </div>

    <!-- Filter Tabs -->
    <div class="notification-filters">
        <div class="filter-tabs">
            <button *ngFor="let filter of filterOptions; index as i" class="filter-tab"
                [class.active]="selectedFilterIndex === i" (click)="changeFilter(filter.value, i)">
                <div class="filter-label">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                    </svg>
                    <span>{{filter.label}}</span>
                    <span class="filter-count" *ngIf="filter.count > 0">{{filter.count}}</span>
                </div>
            </button>
        </div>
    </div>

    <!-- Notification List -->
    <div class="notification-content">
        <div class="loading-container" *ngIf="isLoading && notifications.length === 0">
            <div class="spinner">
                <div class="spinner-ring"></div>
            </div>
            <p>Memuat notifikasi...</p>
        </div>

        <div class="notification-list" *ngIf="!isLoading || notifications.length > 0">
            <!-- Empty State -->
            <div class="empty-state" *ngIf="!hasNotifications() && !isLoading">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M20 18.69L7.84 6.14 5.27 3.49 4 4.76l2.8 2.8v.01c-.52.99-.8 2.16-.8 3.42v6l-2 2v1h13.73l2 2L21 20.76l-1-2.07zM12 22c1.11 0 2-.89 2-2h-4c0 1.11.89 2 2 2zm6-7.32V11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.15.03-.29.08-.42.12-.1.03-.2.07-.3.11l7.99 7.99.23-.22z" />
                </svg>
                <h3>{{getEmptyStateMessage()}}</h3>
                <p>Notifikasi akan muncul di sini ketika ada aktivitas baru</p>
                <button class="primary-button" (click)="refresh()">
                    <mat-icon>refresh</mat-icon>
                    Refresh
                </button>
            </div>

            <!-- Notification Cards -->
            <div class="notification-item"
                *ngFor="let notification of getFilteredNotifications(); trackBy: trackByNotificationId" [ngClass]="[
                    !notification.isRead ? 'unread' : '',
                    isNotificationExpired(notification) ? 'expired' : '',
                    getNotificationPriorityClass(notification)
                ]" (click)="onNotificationClick(notification)">

                <div class="notification-card">
                    <div class="notification-main">
                        <div class="notification-icon" [style.background-color]="getNotificationColor(notification)">
                            <mat-icon>{{ getNotificationIcon(notification) }}</mat-icon>
                        </div>

                        <div class="notification-content-wrapper">
                            <div class="notification-header-info">
                                <div class="notification-meta-top">
                                    <div class="notification-badge">{{ getNotificationBadge(notification) }}</div>
                                    <span class="notification-type">{{ getNotificationTypeLabel(notification.type) }}</span>
                                    <span class="notification-priority priority-{{ notification.priority.toLowerCase() }}">
                                        {{ getPriorityDisplayText(notification.priority) }}
                                    </span>
                                </div>
                                <h4 class="notification-title-text">{{ notification.title }}</h4>
                            </div>

                            <p class="notification-message">{{ notification.message }}</p>

                            <div class="notification-meta-bottom">
                                <span class="notification-date">{{ notification.createdAt | date:'dd/MM/yyyy' }}</span>
                                <span class="notification-time">{{ notification.createdAt | date:'HH:mm' }}</span>
                            </div>
                        </div>

                        <div class="notification-actions">
                            <div class="unread-indicator" *ngIf="!notification.isRead"></div>
                            <button mat-icon-button
                                    class="mark-read-btn"
                                    (click)="markAsRead(notification.id)"
                                    [disabled]="notification.isRead"
                                    matTooltip="Tandai sebagai sudah dibaca">
                                <mat-icon>{{ notification.isRead ? 'done_all' : 'done' }}</mat-icon>
                            </button>
                            <button mat-icon-button
                                    class="delete-btn" 
                                    (click)="deleteNotification(notification, $event)"
                                    matTooltip="Hapus notifikasi">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </div>

                    <div class="notification-action-button" *ngIf="notification.actionUrl">
                        <button class="secondary-button" (click)="onNotificationClick(notification)">
                            <mat-icon>open_in_new</mat-icon>
                            Lihat Detail
                        </button>
                    </div>

                    <div class="expired-badge" *ngIf="isNotificationExpired(notification)">
                        <mat-icon>schedule</mat-icon>
                        Kedaluwarsa
                    </div>
                </div>
            </div>

            <!-- Load More Button -->
            <div class="load-more-container" *ngIf="hasMoreNotifications && hasNotifications()">
                <button class="secondary-button load-more-btn" (click)="loadMore()" [disabled]="isLoading">
                    <div class="spinner" *ngIf="isLoading">
                        <div class="spinner-ring small"></div>
                    </div>
                    <svg class="icon" *ngIf="!isLoading" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" />
                    </svg>
                    {{isLoading ? 'Memuat...' : 'Muat Lebih Banyak'}}
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="notification-footer" *ngIf="summary?.lastUpdated">
        <span class="last-updated">
            Terakhir diperbarui: {{summary?.lastUpdated | date:'dd/MM/yyyy HH:mm'}}
        </span>
    </div>
</div>

</app-base-layout>