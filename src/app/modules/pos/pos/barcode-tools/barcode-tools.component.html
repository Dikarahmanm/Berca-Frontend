<!-- src/app/modules/pos/barcode-tools/barcode-tools.component.html -->
<div class="barcode-scanner">
    <!-- Header -->
    <div class="scanner-header">
        <h2 class="scanner-title">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M3 5v4h2V7h2V5H3zm2 10H3v4h4v-2H5v-2zm14 4h-4v2h6v-4h-2v2zm0-16h-2v2h2v2h2V5h-2V3zM6 17h1.5v-6H6v6zm3.5 0H11v-6H9.5v6zm2.5 0h1.5v-6H12v6zm3.5 0H17v-6h-1.5v6z" />
            </svg>
            Scanner Barcode
        </h2>

        <button class="close-btn" (click)="closeBarcodeScanner()" title="Tutup Scanner">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
        </button>
    </div>

    <!-- Camera Section -->
    <div class="camera-section">
        <div class="camera-container" *ngIf="isCameraActive">
            <video #videoElement autoplay playsinline muted class="camera-video"></video>
            <canvas #canvasElement class="camera-canvas" style="display: none;"></canvas>

            <!-- Scanning Overlay -->
            <div class="scanning-overlay">
                <div class="scan-frame">
                    <div class="scan-corners">
                        <div class="corner top-left"></div>
                        <div class="corner top-right"></div>
                        <div class="corner bottom-left"></div>
                        <div class="corner bottom-right"></div>
                    </div>
                    <div class="scan-line" [class.active]="isScanning"></div>
                </div>
                <p class="scan-instruction">Arahkan barcode ke dalam frame</p>
            </div>
        </div>

        <!-- Error Message -->
        <div class="camera-error" *ngIf="errorMessage">
            <svg class="error-icon" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
            </svg>
            <p>{{errorMessage}}</p>
            <button class="retry-btn" (click)="startCamera()">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                </svg>
                Coba Lagi
            </button>
        </div>
    </div>

    <!-- Controls -->
    <div class="scanner-controls">
        <div class="control-buttons">
            <button class="primary-button" (click)="toggleScanning()" [disabled]="!isCameraActive"
                [class.scanning]="isScanning">
                <svg class="icon" *ngIf="!isScanning" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z" />
                </svg>
                <svg class="icon" *ngIf="isScanning" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                </svg>
                {{isScanning ? 'Stop Scan' : 'Mulai Scan'}}
            </button>

            <button class="secondary-button" (click)="focusManualInput()">
                <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                </svg>
                Input Manual
            </button>
        </div>

        <!-- Manual Input -->
        <div class="manual-input-section">
            <div class="input-group">
                <label for="manualBarcode">Input Barcode Manual:</label>
                <div class="input-wrapper">
                    <input #manualInput id="manualBarcode" type="text" [(ngModel)]="manualBarcode"
                        (keypress)="onManualKeyPress($event)" placeholder="Ketik atau scan barcode..."
                        class="manual-input">
                    <button class="submit-btn" (click)="onManualSubmit()" [disabled]="!manualBarcode.trim()">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Status -->
    <div class="scanner-status">
        <div class="status-indicator" [class.active]="isCameraActive" [class.scanning]="isScanning">
            <div class="status-dot"></div>
            <span class="status-text">
                {{!isCameraActive ? 'Kamera tidak aktif' : (isScanning ? 'Sedang scanning...' : 'Kamera siap')}}
            </span>
        </div>
    </div>

    <!-- Instructions -->
    <div class="scanner-instructions">
        <h3>Cara Menggunakan:</h3>
        <ul>
            <li>Pastikan kamera sudah diizinkan akses</li>
            <li>Arahkan barcode ke dalam frame putih</li>
            <li>Barcode akan otomatis terdeteksi</li>
            <li>Atau ketik barcode manual di kolom input</li>
        </ul>
    </div>
</div>