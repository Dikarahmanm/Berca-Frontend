<!-- ✅ REDESIGNED: User Profile - Clean Simple Design -->
<div class="user-profile-container">
  
  <!-- Enhanced Header Section -->
  <div class="profile-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">
          <mat-icon class="title-icon">account_circle</mat-icon>
          User Profile
        </h1>
        <p class="page-subtitle">Manage your account information and preferences</p>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-outline" (click)="goBack()" [disabled]="isLoading()">
          <mat-icon>arrow_back</mat-icon>
          Back to Dashboard
        </button>
        
        <button 
          class="btn btn-primary" 
          (click)="refreshProfile()"
          [disabled]="isLoading()">
          <mat-icon [class.spinning]="isLoading()">refresh</mat-icon>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Profile Stats Cards -->
  <section class="profile-stats-section">
    <div class="stats-grid">
      <div class="stat-card completeness">
        <div class="stat-icon">
          <mat-icon>trending_up</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ profileStats().profileCompleteness }}%</div>
          <div class="stat-label">Profile Complete</div>
          <div class="stat-meta">{{ getCompletenessMessage() }}</div>
        </div>
      </div>
      
      <div class="stat-card updated">
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatRelativeTime(profileStats().lastUpdated) }}</div>
          <div class="stat-label">Last Updated</div>
          <div class="stat-meta">Profile information</div>
        </div>
      </div>
      
      <div class="stat-card role">
        <div class="stat-icon">
          <mat-icon>{{ getRoleIcon() }}</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getRoleDisplayName() }}</div>
          <div class="stat-label">Current Role</div>
          <div class="stat-meta">System access level</div>
        </div>
      </div>
      
      <div class="stat-card account-age">
        <div class="stat-icon">
          <mat-icon>cake</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ profileStats().accountAge }}</div>
          <div class="stat-label">Days Active</div>
          <div class="stat-meta">Since registration</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Success/Error Messages -->
  <div class="message-container" *ngIf="successMessage() || errorMessage()">
    <div class="alert alert-success" *ngIf="successMessage()">
      <mat-icon class="alert-icon">check_circle</mat-icon>
      <span>{{ successMessage() }}</span>
      <button class="close-btn" (click)="clearMessages()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="alert alert-error" *ngIf="errorMessage()">
      <mat-icon class="alert-icon">error</mat-icon>
      <span>{{ errorMessage() }}</span>
      <button class="close-btn" (click)="clearMessages()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading() && !currentProfile()">
    <div class="loading-spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Main Profile Content -->
  <div class="profile-content" *ngIf="!isLoading() || currentProfile()">
    
    <div class="profile-grid">
      
      <!-- Photo Section -->
      <div class="photo-section glass-card">
        <h3 class="section-title">
          <mat-icon class="section-icon">photo_camera</mat-icon>
          Profile Photo
        </h3>

        <div class="avatar-section">
          <div class="avatar-container"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDrop($event)"
               [class.drag-over]="isDragOver()">
            
            <div class="avatar-wrapper">
              <img [src]="currentAvatarUrl()" 
                   alt="Profile Photo"
                   class="profile-avatar">
              <div class="avatar-overlay" (click)="triggerFileInput()">
                <mat-icon class="camera-icon">camera_alt</mat-icon>
                <span>Change Photo</span>
                <small>Drag & drop or click</small>
              </div>
            </div>
            
            <input #fileInput 
                   type="file" 
                   accept="image/*" 
                   (change)="onPhotoSelect($event)"
                   class="file-input">
          </div>

          <div class="photo-actions" *ngIf="selectedFile() || hasCustomPhoto()">
            <button *ngIf="selectedFile()" 
                    class="btn btn-primary btn-sm" 
                    (click)="uploadPhoto()"
                    [disabled]="isUploading()">
              <mat-icon [class.spinning]="isUploading()">cloud_upload</mat-icon>
              {{ isUploading() ? 'Uploading...' : 'Save Photo' }}
            </button>

            <button *ngIf="hasCustomPhoto() && !selectedFile()" 
                    class="btn btn-outline btn-sm"
                    (click)="deletePhoto()" 
                    [disabled]="isUploading()">
              <mat-icon>delete</mat-icon>
              Remove Photo
            </button>
          </div>

          <div class="photo-info">
            <div class="info-item">
              <mat-icon class="info-icon">info</mat-icon>
              <span>Max 2MB • JPG, PNG, WEBP • 400x400 recommended</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Section -->
      <div class="form-section glass-card">
        <h3 class="section-title">
          <mat-icon class="section-icon">person</mat-icon>
          Personal Information
        </h3>

        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
          
          <!-- Personal Information -->
          <div class="form-group-section">
            <div class="form-row">
              <!-- Full Name -->
              <div class="form-group">
                <label for="fullName" class="form-label required">Full Name</label>
                <input 
                  id="fullName"
                  type="text" 
                  formControlName="fullName"
                  class="form-input"
                  [class.error]="isFieldInvalid('fullName')"
                  placeholder="Enter your full name">
                <span *ngIf="isFieldInvalid('fullName')" class="error-message">
                  {{ getFieldError('fullName') }}
                </span>
              </div>

              <!-- Gender -->
              <div class="form-group">
                <label for="gender" class="form-label required">Gender</label>
                <select 
                  id="gender"
                  formControlName="gender"
                  class="form-select"
                  [class.error]="isFieldInvalid('gender')">
                  <option value="">Select gender</option>
                  <option *ngFor="let option of genderOptions()" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
                <span *ngIf="isFieldInvalid('gender')" class="error-message">
                  {{ getFieldError('gender') }}
                </span>
              </div>
            </div>

            <!-- Contact Information -->
            <div class="form-row">
              <!-- Email -->
              <div class="form-group">
                <label for="email" class="form-label required">Email Address</label>
                <input 
                  id="email"
                  type="email" 
                  formControlName="email"
                  class="form-input"
                  [class.error]="isFieldInvalid('email')"
                  placeholder="Enter your email address">
                <span *ngIf="isFieldInvalid('email')" class="error-message">
                  {{ getFieldError('email') }}
                </span>
              </div>

              <!-- Phone -->
              <div class="form-group">
                <label for="phoneNumber" class="form-label">Phone Number</label>
                <input 
                  id="phoneNumber"
                  type="tel" 
                  formControlName="phoneNumber"
                  class="form-input"
                  [class.error]="isFieldInvalid('phoneNumber')"
                  placeholder="Enter your phone number">
                <span *ngIf="isFieldInvalid('phoneNumber')" class="error-message">
                  {{ getFieldError('phoneNumber') }}
                </span>
              </div>
            </div>
          </div>

          <!-- Work Information -->
          <div class="form-group-section">
            <h4 class="section-subtitle">
              <mat-icon>business</mat-icon>
              Work Information
            </h4>
            
            <div class="form-row">
              <!-- Department -->
              <div class="form-group">
                <label for="department" class="form-label">Department</label>
                <select 
                  id="department"
                  formControlName="department"
                  class="form-select">
                  <option value="">Select department</option>
                  <option *ngFor="let option of departmentOptions()" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>

              <!-- Position -->
              <div class="form-group">
                <label for="position" class="form-label">Position</label>
                <select 
                  id="position"
                  formControlName="position"
                  class="form-select">
                  <option value="">Select position</option>
                  <option *ngFor="let option of positionOptions()" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
            </div>

            <!-- Division -->
            <div class="form-group">
              <label for="division" class="form-label">Division</label>
              <input 
                id="division"
                type="text" 
                formControlName="division"
                class="form-input"
                placeholder="Enter your division">
            </div>
          </div>

          <!-- Bio Section -->
          <div class="form-group-section">
            <h4 class="section-subtitle">
              <mat-icon>description</mat-icon>
              About Me
            </h4>
            
            <div class="form-group">
              <label for="bio" class="form-label">Bio</label>
              <textarea 
                id="bio"
                formControlName="bio"
                class="form-textarea"
                rows="4"
                maxlength="500"
                placeholder="Tell us about yourself..."></textarea>
              <div class="char-counter">
                <span [class.warning]="charCount() > 450">{{ charCount() }}/500 characters</span>
              </div>
            </div>
          </div>

          <!-- User Info Display -->
          <div class="user-info-display" *ngIf="currentProfile()">
            <h4 class="section-subtitle">
              <mat-icon>info</mat-icon>
              Account Information
            </h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Username:</span>
                <span class="info-value">{{ currentProfile()?.username }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Role:</span>
                <span class="info-value role-badge" [attr.data-role]="currentProfile()?.role">
                  {{ getRoleDisplayName() }}
                </span>
              </div>
              <div class="info-item">
                <span class="info-label">Joined:</span>
                <span class="info-value">{{ currentProfile()?.createdAt | date:'dd MMM yyyy' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Last Updated:</span>
                <span class="info-value">{{ currentProfile()?.updatedAt | date:'dd MMM yyyy, HH:mm' }}</span>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" 
                    class="btn btn-outline" 
                    (click)="resetForm()"
                    [disabled]="isSaving() || !hasChanges()">
              <mat-icon>refresh</mat-icon>
              Reset Changes
            </button>
            
            <button type="submit" 
                    class="btn btn-primary" 
                    [disabled]="profileForm.invalid || isSaving() || !hasChanges()">
              <mat-icon [class.spinning]="isSaving()">save</mat-icon>
              {{ isSaving() ? 'Saving...' : 'Save Profile' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>