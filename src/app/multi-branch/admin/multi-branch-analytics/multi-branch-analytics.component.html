<div class="multi-branch-analytics-container">
  <div class="modern-header">
    <div class="header-title-section">
      <h1 class="modern-title">
        <mat-icon class="title-icon">analytics</mat-icon>
        Multi-Branch Network Analytics
      </h1>
      <div class="subtitle-stats">
        <span class="stat-chip">{{ summary().activeBranches }}/{{ summary().totalBranches }} Active Branches</span>
        <span class="stat-chip period">{{ selectedPeriod() }}</span>
        <span class="stat-chip" [class]="performanceStatus().class">{{ performanceStatus().status }}</span>
      </div>
    </div>

    <div class="header-actions">
      <button
        mat-raised-button
        color="accent"
        class="action-btn"
        (click)="onExportSummary()"
        [disabled]="loading()"
      >
        <mat-icon>file_download</mat-icon>
        Export Summary
      </button>

      <button
        mat-raised-button
        color="primary"
        class="action-btn"
        (click)="onDownloadReport()"
        [disabled]="loading()"
      >
        <mat-icon>download</mat-icon>
        Full Report
      </button>
    </div>
  </div>

  <div class="controls-section">
    <mat-card class="controls-card">
      <mat-card-content>
        <div class="controls-grid">
          <div class="period-selector">
            <mat-label>Analysis Period</mat-label>
            <div class="period-buttons">
              <mat-button-toggle-group [value]="selectedPeriod()" (change)="onPeriodChange($event.value)">
                <mat-button-toggle value="1M">1 Month</mat-button-toggle>
                <mat-button-toggle value="3M">3 Months</mat-button-toggle>
                <mat-button-toggle value="6M">6 Months</mat-button-toggle>
                <mat-button-toggle value="1Y">1 Year</mat-button-toggle>
              </mat-button-toggle-group>
            </div>
          </div>

          <div class="view-selector">
            <mat-label>View Type</mat-label>
            <div class="view-buttons">
              <mat-button-toggle-group [value]="selectedView()" (change)="onViewChange($event.value)">
                <mat-button-toggle value="overview">Overview</mat-button-toggle>
                <mat-button-toggle value="trends">Trends</mat-button-toggle>
                <mat-button-toggle value="regional">Regional</mat-button-toggle>
                <mat-button-toggle value="forecast">Forecast</mat-button-toggle>
                <mat-button-toggle value="executive">Executive</mat-button-toggle>
              </mat-button-toggle-group>
            </div>
          </div>

          <div class="action-controls">
            <button
              mat-raised-button
              color="primary"
              (click)="onRefreshData()"
              [disabled]="loading()"
            >
              <mat-icon [class.spin]="loading()">refresh</mat-icon>
              Refresh Data
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Analytics Summary Cards -->
  <div class="analytics-summary">
    <div class="summary-cards">
      <mat-card class="summary-card branches-card">
        <mat-card-content>
          <div class="card-header">
            <mat-icon class="card-icon">business</mat-icon>
            <span class="card-title">Branches</span>
          </div>
          <div class="card-value">{{ summary().activeBranches }}/{{ summary().totalBranches }}</div>
          <div class="card-subtitle">Active Locations</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card transfers-card">
        <mat-card-content>
          <div class="card-header">
            <mat-icon class="card-icon">swap_horiz</mat-icon>
            <span class="card-title">Transfers</span>
          </div>
          <div class="card-value">{{ summary().totalTransfers }}</div>
          <div class="card-subtitle">{{ summary().pendingTransfers }} Pending</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card sales-card">
        <mat-card-content>
          <div class="card-header">
            <mat-icon class="card-icon">attach_money</mat-icon>
            <span class="card-title">Total Sales</span>
          </div>
          <div class="card-value">{{ formatCurrency(summary().totalSales) }}</div>
          <div class="card-subtitle">Network Revenue</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card performance-card">
        <mat-card-content>
          <div class="card-header">
            <mat-icon class="card-icon">trending_up</mat-icon>
            <span class="card-title">Performance</span>
          </div>
          <div class="card-value">{{ summary().averagePerformance }}%</div>
          <div class="card-subtitle" [class]="performanceStatus().class">{{ performanceStatus().status }}</div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Dynamic Content Based on Selected View -->
  <div class="analytics-content">
    @if (loading()) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading analytics data...</p>
      </div>
    } @else {
      @switch (selectedView()) {
        @case ('overview') {
          <div class="overview-view">
            <mat-card class="performance-table-card">
              <mat-card-header>
                <mat-card-title>Branch Performance Overview</mat-card-title>
                <mat-card-subtitle>Current performance metrics across all branches</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                @if (branchPerformance().length > 0) {
                  <table mat-table [dataSource]="branchPerformance()" class="performance-table">
                    <!-- Branch Name Column -->
                    <ng-container matColumnDef="branchName">
                      <th mat-header-cell *matHeaderCellDef>Branch Name</th>
                      <td mat-cell *matCellDef="let branch">
                        <div class="branch-cell">
                          <mat-icon class="branch-icon">store</mat-icon>
                          <span>{{ branch.branchName }}</span>
                        </div>
                      </td>
                    </ng-container>

                    <!-- Sales Total Column -->
                    <ng-container matColumnDef="salesTotal">
                      <th mat-header-cell *matHeaderCellDef>Sales Total</th>
                      <td mat-cell *matCellDef="let branch">{{ formatCurrency(branch.salesTotal) }}</td>
                    </ng-container>

                    <!-- Transfers Count Column -->
                    <ng-container matColumnDef="transfersCount">
                      <th mat-header-cell *matHeaderCellDef>Transfers</th>
                      <td mat-cell *matCellDef="let branch">
                        <span class="transfer-count">{{ branch.transfersCount }}</span>
                      </td>
                    </ng-container>

                    <!-- Performance Column -->
                    <ng-container matColumnDef="performance">
                      <th mat-header-cell *matHeaderCellDef>Performance</th>
                      <td mat-cell *matCellDef="let branch">
                        <div class="performance-cell">
                          <div class="performance-bar">
                            <div class="performance-fill" [style.width.%]="branch.performance"></div>
                          </div>
                          <span class="performance-value">{{ branch.performance }}%</span>
                        </div>
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="['branchName', 'salesTotal', 'transfersCount', 'performance']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['branchName', 'salesTotal', 'transfersCount', 'performance'];"></tr>
                  </table>
                } @else {
                  <div class="no-data-container">
                    <mat-icon class="no-data-icon">analytics</mat-icon>
                    <h3>No Performance Data</h3>
                    <p>Performance analytics will be displayed here when data is available.</p>
                  </div>
                }
              </mat-card-content>
            </mat-card>
          </div>
        }

        @case ('trends') {
          <div class="trends-view">
            <mat-card class="trends-card">
              <mat-card-header>
                <mat-card-title>Performance Trends Analysis</mat-card-title>
                <mat-card-subtitle>{{ selectedPeriod() }} trend analysis across branches</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="trends-content">
                  <div class="trend-metrics">
                    @for (metric of getTrendMetrics(); track metric.title) {
                      <div class="metric-card">
                        <mat-icon [color]="metric.trend === 'positive' ? 'primary' : 'warn'">trending_up</mat-icon>
                        <div class="metric-info">
                          <h4>{{ metric.title }}</h4>
                          <span class="trend-value" [class]="metric.trend">{{ metric.value }}</span>
                          <div class="metric-change" [class]="metric.trend">{{ metric.description }}</div>
                        </div>
                      </div>
                    }
                  </div>

                  <div class="chart-placeholder">
                    <mat-icon style="font-size: 48px; color: #ccc;">show_chart</mat-icon>
                    <h3>Trend Chart</h3>
                    <p>Interactive trend visualization will be implemented with Chart.js integration</p>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        }

        @case ('regional') {
          <div class="regional-view">
            <mat-card class="regional-card">
              <mat-card-header>
                <mat-card-title>Regional Performance Analysis</mat-card-title>
                <mat-card-subtitle>Geographic distribution and performance comparison</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="regional-content">
                  <div class="regional-map">
                    <mat-icon style="font-size: 64px; color: #4BBF7B;">map</mat-icon>
                    <h3>Jakarta Region Overview</h3>
                    <p>Geographic visualization showing branch locations and performance heatmap</p>
                  </div>

                  <div class="regional-stats">
                    @for (region of getRegionalStats(); track region.name) {
                      <div class="region-item">
                        <mat-icon color="primary">location_city</mat-icon>
                        <div class="region-info">
                          <h4>{{ region.name }}</h4>
                          <span class="region-performance" [class]="region.status">{{ region.performance }}% Performance</span>
                          <p>{{ region.description }}</p>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        }

        @case ('forecast') {
          <div class="forecast-view">
            <mat-card class="forecast-card">
              <mat-card-header>
                <mat-card-title>Performance Forecast</mat-card-title>
                <mat-card-subtitle>Predictive analytics for next {{ selectedPeriod() }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="forecast-content">
                  <div class="forecast-summary">
                    @for (forecast of getForecastMetrics(); track forecast.title) {
                      <div class="forecast-metric">
                        <mat-icon [color]="forecast.trend === 'positive' ? 'primary' : 'warn'">insights</mat-icon>
                        <div class="forecast-info">
                          <h4>{{ forecast.title }}</h4>
                          <span class="forecast-value" [class]="forecast.trend">{{ forecast.value }}</span>
                          <div class="confidence">{{ forecast.confidence }} Confidence</div>
                        </div>
                      </div>
                    }
                  </div>

                  <div class="forecast-chart">
                    <mat-icon style="font-size: 48px; color: #FF914D;">analytics</mat-icon>
                    <h3>Predictive Model</h3>
                    <p>AI-powered forecasting based on historical data and seasonal patterns</p>
                    <div class="forecast-factors">
                      <h4>Key Factors:</h4>
                      <ul>
                        <li>Historical performance trends</li>
                        <li>Seasonal variations</li>
                        <li>Market conditions</li>
                        <li>Transfer efficiency patterns</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        }

        @case ('executive') {
          <div class="executive-view">
            <mat-card class="executive-card">
              <mat-card-header>
                <mat-card-title>Executive Summary</mat-card-title>
                <mat-card-subtitle>High-level insights for {{ selectedPeriod() }} period</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="executive-content">
                  <div class="executive-metrics">
                    <div class="exec-metric primary">
                      <mat-icon>assessment</mat-icon>
                      <div class="metric-data">
                        <span class="metric-value">{{ formatCurrency(summary().totalSales) }}</span>
                        <span class="metric-label">Total Network Revenue</span>
                        <span class="metric-change positive">+12.5% vs previous period</span>
                      </div>
                    </div>
                    <div class="exec-metric secondary">
                      <mat-icon>business</mat-icon>
                      <div class="metric-data">
                        <span class="metric-value">{{ summary().averagePerformance }}%</span>
                        <span class="metric-label">Average Performance Score</span>
                        <span class="metric-change neutral">Stable performance</span>
                      </div>
                    </div>
                  </div>

                  <div class="executive-insights">
                    <div class="insight-section">
                      <h4><mat-icon color="primary">lightbulb</mat-icon> Key Insights</h4>
                      <ul>
                        @for (insight of getExecutiveInsights(); track insight) {
                          <li>{{ insight }}</li>
                        }
                      </ul>
                    </div>

                    <div class="insight-section">
                      <h4><mat-icon color="accent">flag</mat-icon> Recommendations</h4>
                      <ul>
                        @for (recommendation of getExecutiveRecommendations(); track recommendation) {
                          <li>{{ recommendation }}</li>
                        }
                      </ul>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        }
      }

      <!-- Quick Navigation -->
      <div class="quick-navigation">
        <mat-card class="navigation-card">
          <mat-card-content>
            <h3>Quick Access</h3>
            <div class="navigation-buttons">
              <button mat-stroked-button routerLink="/dashboard/transfers" color="primary">
                <mat-icon>swap_horiz</mat-icon>
                Transfer Management
              </button>
              <button mat-stroked-button routerLink="/dashboard/branches" color="accent">
                <mat-icon>business</mat-icon>
                Branch Management
              </button>
              <button mat-stroked-button routerLink="/dashboard/branch-performance" color="warn">
                <mat-icon>trending_up</mat-icon>
                Performance Details
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    }
  </div>
</div>