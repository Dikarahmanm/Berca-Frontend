<!-- src/app/shared/components/unified-notification-center/unified-notification-center.component.html -->
<div class="unified-notification-dropdown">
    <!-- Enhanced Notification Bell Button -->
    <button 
        mat-icon-button 
        [matBadge]="getBadgeText()" 
        [matBadgeHidden]="!hasUnreadNotifications()"
        matBadgeColor="warn" 
        matBadgeSize="small" 
        (click)="toggleDropdown()" 
        [class.active]="isOpen"
        matTooltip="Notifikasi ({{getBadgeCount()}} belum dibaca)" 
        class="notification-trigger">
        <mat-icon [class.has-unread]="hasUnreadNotifications()">
            {{hasUnreadNotifications() ? 'notifications_active' : 'notifications'}}
        </mat-icon>
    </button>

    <!-- Enhanced Dropdown Menu -->
    <div class="notification-menu" [class.show]="isOpen">
        
        <!-- Enhanced Header -->
        <div class="notification-menu-header">
            <div class="header-title">
                <mat-icon>notifications</mat-icon>
                <span>Notifikasi Terbaru</span>
                <span class="unread-count" *ngIf="hasUnreadNotifications()">
                    {{getBadgeCount()}}
                </span>
            </div>

            <div class="header-actions">
                <button 
                    mat-icon-button 
                    (click)="refreshNotifications()" 
                    matTooltip="Refresh notifikasi"
                    class="refresh-btn">
                    <mat-icon>refresh</mat-icon>
                </button>

                <button 
                    mat-icon-button 
                    (click)="markAllAsRead()" 
                    [disabled]="!hasUnreadNotifications()"
                    matTooltip="Tandai semua sebagai dibaca" 
                    class="mark-all-read-btn">
                    <mat-icon>done_all</mat-icon>
                </button>

                <button 
                    mat-icon-button 
                    (click)="viewAllNotifications()" 
                    matTooltip="Lihat semua notifikasi"
                    class="view-all-btn">
                    <mat-icon>open_in_new</mat-icon>
                </button>
            </div>
        </div>

        <!-- Enhanced Loading State -->
        <div class="notification-loading" *ngIf="isLoading">
            <mat-spinner diameter="28"></mat-spinner>
            <span>Memuat notifikasi terbaru...</span>
        </div>

        <!-- Enhanced Error State -->
        <div class="notification-error" *ngIf="error && !isLoading">
            <mat-icon>error_outline</mat-icon>
            <span>{{error}}</span>
            <button mat-button (click)="refreshNotifications()" class="retry-btn">
                <mat-icon>refresh</mat-icon>
                Coba Lagi
            </button>
        </div>

        <!-- Enhanced Notification List -->
        <div class="notification-list" *ngIf="!isLoading && !error">
            
            <!-- Enhanced Empty State -->
            <div class="notification-empty" *ngIf="recentNotifications.length === 0">
                <mat-icon>notifications_off</mat-icon>
                <span>{{getEmptyStateMessage()}}</span>
                <small>Semua notifikasi sudah dibaca</small>
            </div>

            <!-- Enhanced Notification Items -->
            <div class="notification-items" *ngIf="recentNotifications.length > 0">
                <div 
                    *ngFor="let notification of recentNotifications; trackBy: trackByNotificationId"
                    class="notification-item"
                    [class.unread]="!notification.isRead"
                    [class]="getNotificationPriorityClass(notification)"
                    (click)="onNotificationClick(notification)"
                    [matTooltip]="getNotificationTooltip(notification)"
                    matTooltipPosition="left">
                    
                    <!-- Enhanced Notification Icon -->
                    <div class="notification-icon">
                        <mat-icon [class.unread-icon]="!notification.isRead">
                            {{getNotificationIcon(notification)}}
                        </mat-icon>
                    </div>

                    <!-- Enhanced Notification Content -->
                    <div class="notification-content">
                        <div class="notification-title">
                            {{notification.title}}
                            <span class="priority-badge" 
                                  *ngIf="notification.priority && notification.priority !== 'normal'"
                                  [class]="'priority-' + notification.priority.toLowerCase()">
                                {{getPriorityText(notification.priority)}}
                            </span>
                        </div>
                        
                        <div class="notification-message">
                            {{notification.message}}
                        </div>
                        
                        <div class="notification-meta">
                            <span class="notification-time">
                                {{getTimeAgoText(notification)}}
                            </span>
                            <span class="notification-branch" *ngIf="notification.branchName">
                                • {{notification.branchName}}
                            </span>
                            <span class="notification-type" *ngIf="notification.type">
                                • {{getTypeDisplayText(notification.type)}}
                            </span>
                        </div>
                        
                        <!-- Action indicator -->
                        <div class="notification-action" *ngIf="notification.actionUrl">
                            <small>Klik untuk lihat detail</small>
                        </div>
                    </div>

                    <!-- Enhanced Unread Indicator -->
                    <div class="unread-indicator" *ngIf="!notification.isRead"></div>
                    
                    <!-- Priority indicator -->
                    <div class="priority-indicator" 
                         *ngIf="notification.priority === 'high'"
                         matTooltip="Prioritas Tinggi">
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Footer with summary -->
        <div class="notification-menu-footer" *ngIf="recentNotifications.length > 0 && !isLoading && !error">
            <mat-divider></mat-divider>
            
            <!-- Summary info -->
            <div class="notification-summary" *ngIf="summary">
                <small>
                    Menampilkan {{recentNotifications.length}} dari {{summary.totalCount}} notifikasi
                    <span *ngIf="hasUnreadNotifications()"> • {{getBadgeCount()}} belum dibaca</span>
                </small>
            </div>
            
            <button 
                mat-button 
                (click)="viewAllNotifications()" 
                class="view-all-footer-btn">
                <mat-icon>open_in_new</mat-icon>
                <span>Lihat Semua Notifikasi</span>
            </button>
        </div>
    </div>
</div>