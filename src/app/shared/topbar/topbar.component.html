<!-- Topbar Component - Clean Structure -->
<header class="topbar">
  <div class="topbar-container">
    
    <!-- Left Section - Brand -->
    <div class="topbar-left">
      <div class="brand" (click)="navigateHome()">
        <div class="brand-logo">
          <mat-icon>store</mat-icon>
        </div>
        <span class="brand-text">Toko Eniwan</span>
      </div>
    </div>

    <!-- Center Section - Page Title -->
    <div class="topbar-center">
      <h1 class="page-title">{{ pageTitle }}</h1>
    </div>

    <!-- Right Section - Actions -->
    <div class="topbar-right">
      
      <!-- Notifications -->
      <div class="notification-wrapper">
        <button 
          class="notification-btn"
          (click)="toggleNotificationDropdown()"
          [class.active]="showNotificationDropdown">
          <mat-icon>notifications</mat-icon>
          <span class="notification-badge" *ngIf="notificationCount > 0">{{ notificationCount > 99 ? '99+' : notificationCount }}</span>
        </button>

        <!-- Custom Notification Dropdown -->
        <div class="custom-dropdown notification-dropdown" *ngIf="showNotificationDropdown" (click)="$event.stopPropagation()">
          
          <!-- Header -->
          <div class="dropdown-header">
            <div class="header-content">
              <div class="header-icon">
                <mat-icon>notifications</mat-icon>
              </div>
              <div class="header-info">
                <h3 class="header-title">Notifications</h3>
                <p class="header-subtitle">{{ notificationCount }} new notifications</p>
              </div>
            </div>
            <div class="header-actions">
              <button class="header-btn" (click)="markAllAsRead()">
                <mat-icon>done_all</mat-icon>
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="dropdown-body">
            <div class="notification-list" *ngIf="recentNotifications.length > 0">
              <div 
                class="notification-item" 
                *ngFor="let notification of recentNotifications.slice(0, 5)"
                [class.unread]="!notification.isRead"
                (click)="onNotificationClick(notification)">
                
                <div class="item-icon">
                  <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
                </div>
                
                <div class="item-content">
                  <h4 class="item-title">{{ notification.title }}</h4>
                  <p class="item-message">{{ notification.message }}</p>
                  <span class="item-time">{{ getRelativeTime(notification.createdAt) }}</span>
                </div>
                
                <div class="item-actions" *ngIf="!notification.isRead">
                  <button class="mark-read-btn" (click)="markNotificationAsRead(notification.id); $event.stopPropagation()">
                    <mat-icon>done</mat-icon>
                  </button>
                </div>
              </div>
            </div>

            <div class="empty-state" *ngIf="recentNotifications.length === 0">
              <mat-icon>notifications_none</mat-icon>
              <h4>No notifications</h4>
              <p>You're all caught up!</p>
            </div>
          </div>

          <!-- Footer -->
          <div class="dropdown-footer" *ngIf="recentNotifications.length > 0">
            <button class="footer-btn" (click)="navigateToNotifications()">
              View all notifications
            </button>
          </div>

        </div>
      </div>

      <!-- Profile -->
      <div class="profile-wrapper">
        <button 
          class="profile-btn"
          (click)="toggleProfileDropdown()"
          [class.active]="showProfileDropdown">
          
          <div class="profile-avatar">
            <img *ngIf="userPhoto; else avatarInitials" [src]="userPhoto" [alt]="username">
            <ng-template #avatarInitials>
              <span>{{ getInitials(username) }}</span>
            </ng-template>
          </div>
          
          <div class="profile-info" *ngIf="!isMobile">
            <span class="profile-name">{{ username }}</span>
            <span class="profile-role">{{ getRoleDisplay(role) }}</span>
          </div>
          
          <mat-icon class="profile-arrow" *ngIf="!isMobile">expand_more</mat-icon>
        </button>

        <!-- Custom Profile Dropdown -->
        <div class="custom-dropdown profile-dropdown" *ngIf="showProfileDropdown" (click)="$event.stopPropagation()">
          
          <!-- Header -->
          <div class="dropdown-header">
            <div class="profile-header-content">
              <div class="profile-avatar-large">
                <img *ngIf="userPhoto; else avatarInitialsLarge" [src]="userPhoto" [alt]="username">
                <ng-template #avatarInitialsLarge>
                  <span>{{ getInitials(username) }}</span>
                </ng-template>
              </div>
              <div class="profile-details">
                <h3 class="profile-name-large">{{ username || 'Guest User' }}</h3>
                <p class="profile-role-large">{{ getRoleDisplay(role) }}</p>
                <div class="status-indicator">
                  <div class="status-dot"></div>
                  <span>Online</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Content -->
          <div class="dropdown-body">
            <div class="menu-section">
              <h4 class="section-title">Account</h4>
              
              <div class="menu-item" (click)="navigateToProfile()">
                <div class="menu-item-icon">
                  <mat-icon>person</mat-icon>
                </div>
                <div class="menu-item-content">
                  <span class="menu-item-title">Edit Profile</span>
                </div>
                <mat-icon class="menu-item-arrow">chevron_right</mat-icon>
              </div>

              <div class="menu-item" (click)="navigateToSettings()">
                <div class="menu-item-icon">
                  <mat-icon>settings</mat-icon>
                </div>
                <div class="menu-item-content">
                  <span class="menu-item-title">Settings</span>
                </div>
                <mat-icon class="menu-item-arrow">chevron_right</mat-icon>
              </div>
            </div>

            <div class="menu-section">
              <h4 class="section-title">Preferences</h4>
              
              <div class="menu-item toggle-item" (click)="toggleTheme()">
                <div class="menu-item-icon">
                  <mat-icon>{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
                </div>
                <div class="menu-item-content">
                  <span class="menu-item-title">{{ isDarkMode ? 'Light Mode' : 'Dark Mode' }}</span>
                </div>
                <div class="toggle-switch" [class.active]="isDarkMode">
                  <div class="toggle-slider"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="dropdown-footer">
            <div class="menu-item logout-item" (click)="logout()" [class.disabled]="isLoggingOut">
              <div class="menu-item-icon">
                <mat-icon *ngIf="!isLoggingOut">logout</mat-icon>
                <mat-spinner *ngIf="isLoggingOut" diameter="20"></mat-spinner>
              </div>
              <div class="menu-item-content">
                <span class="menu-item-title">
                  {{ isLoggingOut ? 'Logging out...' : 'Logout' }}
                </span>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</header>