<!-- src/app/shared/topbar/topbar.component.html -->
<header class="topbar">
    <div class="topbar-content">
        <!-- Left Section: Logo & Page Title -->
        <div class="topbar-left">
            <div class="logo-section" (click)="navigateToHome()">
                <img src="assets/images/logo-eniwan.png" alt="Eniwan Logo" class="logo-img">
                <div class="brand-info">
                    <h1 class="brand-title">POS Eniwan</h1>
                    <span class="brand-subtitle">Warung Kelontong</span>
                </div>
            </div>

            <div class="page-title-section">
                <h2 class="page-title">{{ pageTitle }}</h2>
            </div>
        </div>

        <!-- Center Section: Date & Time -->
        <div class="topbar-center">
            <div class="datetime-display">
                <div class="time">{{ formattedTime }}</div>
                <div class="date">{{ formattedDate }}</div>
            </div>
        </div>

        <!-- Right Section: Actions & Profile -->
        <div class="topbar-right">
            <!-- Quick Actions -->
            <div class="quick-actions">
                <button mat-icon-button class="action-btn" matTooltip="Beranda" (click)="navigateToHome()">
                    <mat-icon>home</mat-icon>
                </button>
            </div>

            <!-- Notifications -->
            <div class="notification-wrapper">
                <button mat-icon-button class="notification-btn" [matBadge]="notificationCount"
                    [matBadgeHidden]="notificationCount === 0" matBadgeColor="warn" matTooltip="Notifikasi"
                    (click)="toggleNotificationDropdown()">
                    <mat-icon>notifications</mat-icon>
                </button>

                <!-- Notification Dropdown -->
                <div class="notification-dropdown" [class.show]="notificationDropdownOpen">
                    <div class="notification-header">
                        <h3>Notifikasi</h3>
                        <span class="notification-count">{{ notifications.length }} item</span>
                    </div>

                    <div class="notification-list" *ngIf="notifications.length > 0; else noNotifications">
                        <div class="notification-item" *ngFor="let notification of notifications"
                            [class.unread]="notification.unread">
                            <div class="notification-icon" [style.color]="getNotificationColor(notification.type)">
                                <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
                            </div>
                            <div class="notification-content">
                                <h4 class="notification-title">{{ notification.title }}</h4>
                                <p class="notification-message">{{ notification.message }}</p>
                                <span class="notification-time">{{ notification.time }}</span>
                            </div>
                            <button mat-icon-button class="notification-close"
                                (click)="clearNotification(notification.id, $event)">
                                <mat-icon>close</mat-icon>
                            </button>
                        </div>
                    </div>

                    <ng-template #noNotifications>
                        <div class="no-notifications">
                            <mat-icon>notifications_none</mat-icon>
                            <p>Tidak ada notifikasi</p>
                        </div>
                    </ng-template>

                    <div class="notification-footer" *ngIf="notifications.length > 0">
                        <button mat-button class="view-all-btn">Lihat Semua</button>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div class="profile-wrapper">
                <div class="profile-trigger" (click)="toggleProfileDropdown()">
                    <div class="profile-info">
                        <div class="welcome-text">{{ welcomeMessage }}</div>
                        <div class="role-badge" [style.background-color]="getRoleColor()">
                            {{ roleDisplayName }}
                        </div>
                    </div>
                    <div class="profile-avatar">
                        <img [src]="avatarUrl" [alt]="username + ' avatar'" (error)="onAvatarError($event)"
                            class="avatar-img">
                        <div class="avatar-status online"></div>
                    </div>
                    <mat-icon class="dropdown-arrow" [class.rotated]="dropdownOpen">
                        expand_more
                    </mat-icon>
                </div>

                <!-- Profile Dropdown -->
                <div class="profile-dropdown" [class.show]="dropdownOpen">
                    <div class="profile-dropdown-header">
                        <div class="profile-avatar-large">
                            <img [src]="avatarUrl" [alt]="username + ' avatar'" (error)="onAvatarError($event)">
                        </div>
                        <div class="profile-details">
                            <h3 class="profile-name">{{ username }}</h3>
                            <span class="profile-role" [style.color]="getRoleColor()">
                                {{ roleDisplayName }}
                            </span>
                            <div class="profile-status">
                                <span class="status-indicator online"></span>
                                Online
                            </div>
                        </div>
                    </div>

                    <div class="profile-dropdown-body">
                        <div class="dropdown-section">
                            <h4>Akun</h4>
                            <button class="dropdown-item" (click)="navigateToProfile()">
                                <mat-icon>person</mat-icon>
                                <span>Edit Profil</span>
                            </button>
                            <button class="dropdown-item">
                                <mat-icon>settings</mat-icon>
                                <span>Pengaturan</span>
                            </button>
                        </div>

                        <div class="dropdown-section">
                            <h4>Bantuan</h4>
                            <button class="dropdown-item">
                                <mat-icon>help_outline</mat-icon>
                                <span>Panduan</span>
                            </button>
                            <button class="dropdown-item">
                                <mat-icon>support</mat-icon>
                                <span>Dukungan</span>
                            </button>
                        </div>
                    </div>

                    <div class="profile-dropdown-footer">
                        <button class="logout-btn" (click)="logout()" [disabled]="isLoading">
                            <mat-icon *ngIf="!isLoading">logout</mat-icon>
                            <mat-icon *ngIf="isLoading" class="spinning">refresh</mat-icon>
                            <span>{{ isLoading ? 'Keluar...' : 'Keluar' }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>